<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿åŠ¨è®¡æ—¶å™¨5.5</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            position: relative;
        }
        
        h1 {
            margin-bottom: 20px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .current-time {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #fdbb2d;
        }
        
        .timer-status-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            width: 100%;
        }
        
        .timer-status {
            font-size: 1.4rem;
            color: #4CAF50;
            font-weight: bold;
            transition: all 0.3s;
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        
        .timer-status.pulsing {
            animation: pulse 1.5s infinite;
        }
        
        .progress-indicator {
            background-color: rgba(253, 187, 45, 0.8);
            color: #333;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            min-width: 50px;
            flex: 0;
        }
        
        .next-phase-indicator {
            font-size: 1.2rem;
            color: #aaa;
            font-weight: bold;
            flex: 1;
            text-align: center;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .phase-info {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            flex-direction: row;
            align-items: center;
            position: relative;
            height: 400px;
            overflow: hidden;
        }
        
        .phase-left {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .phase-right {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            position: relative;
        }
        
        .phase-carousel {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .phase-carousel-track {
            display: flex;
            transition: transform 0.5s ease;
            width: 100%;
            height: 100%;
        }
        
        .phase-carousel-item {
            flex: 0 0 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            transition: all 0.5s ease;
            opacity: 0.3;
            transform: scale(0.8);
        }
        
        .phase-carousel-item.prev {
            opacity: 0.6;
            transform: scale(0.9);
        }
        
        .phase-carousel-item.active {
            opacity: 1;
            transform: scale(1);
        }
        
        .phase-carousel-item.next {
            opacity: 0.6;
            transform: scale(0.9);
        }
        
        .phase-name {
            font-size: 2.2rem;
            color: #fdbb2d;
            margin-bottom: 10px;
        }
        
        .phase-description {
            font-size: 1rem;
            color: #aaa;
            margin-bottom: 15px;
        }
        
        .phase-timer {
            font-size: 9rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            line-height: 1;
            margin-bottom: 10px;
        }
        
        .phase-timer-label {
            font-size: 1.2rem;
            color: #aaa;
        }
        
        .completion-message {
            font-size: 3rem;
            font-weight: bold;
            color: #4CAF50;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
            line-height: 1.2;
            margin-bottom: 20px;
            animation: celebration 2s infinite;
        }
        
        @keyframes celebration {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #fdbb2d;
            font-size: 1.8rem;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .carousel-prev {
            left: 5px;
        }
        
        .carousel-next {
            right: 5px;
        }
        
        .carousel-nav-vertical {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            background: none;
            border: none;
            color: #fdbb2d;
            font-size: 1.8rem;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .carousel-nav-vertical:hover {
            background-color: rgba(253, 187, 45, 0.2);
            transform: translateX(-50%) scale(1.1);
        }
        
        .carousel-prev-vertical {
            top: 5px;
        }
        
        .carousel-next-vertical {
            bottom: 5px;
        }
        
        .total-timer-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }
        
        .start-time, .end-time {
            font-size: 1.2rem;
            color: #aaa;
            flex: 1;
        }
        
        .start-time {
            text-align: left;
        }
        
        .end-time {
            text-align: right;
        }
        
        .total-timer {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4CAF50;
            flex: 2;
            text-align: center;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
            position: relative;
        }
        
        .main-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        button {
            padding: 10px 20px; /* å‡å°æŒ‰é’®å†…è¾¹è· */
            font-size: 1rem; /* å‡å°å­—ä½“å¤§å° */
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            min-width: 90px; /* å‡å°æœ€å°å®½åº¦ */
            position: relative;
            overflow: hidden;
        }
        
        button:after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        button:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
        
        #startBtn {
            background-color: #4CAF50;
            color: white;
        }
        
        #pauseBtn {
            background-color: #FFC107;
            color: black;
        }
        
        #resetBtn {
            background-color: #F44336;
            color: white;
        }
        
        #addTimeBtn {
            background-color: #2196F3;
            color: white;
        }
        
        #subtractTimeBtn {
            background-color: #FF9800;
            color: white;
        }
        
        #finishBtn {
            background-color: #9C27B0;
            color: white;
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button:disabled {
            background-color: #555555 !important; /* æ”¹ä¸ºæ›´æš—çš„é¢œè‰² */
            color: #888888 !important;
            cursor: not-allowed;
            transform: none;
        }
        
        /* æŒ‰é’®æ‚¬åœæ•ˆæœ */
        #subtractTimeBtn:hover:not(:disabled), #startBtn:hover:not(:disabled), #addTimeBtn:hover:not(:disabled), #pauseBtn:hover:not(:disabled), #resetBtn:hover:not(:disabled), #finishBtn:hover:not(:disabled) {
            transform: translateY(-5px) scale(1.05);
        }
        
        /* è®¾ç½®æŒ‰é’®æ ·å¼ */
        .settings-buttons {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
        }
        
        .settings-btn {
            padding: 5px;
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .settings-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .top-right-buttons {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ - ä¼˜åŒ–ç‰ˆ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: linear-gradient(145deg, #2c2c2c, #1f1f1f);
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            text-align: center;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 1px solid #444;
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .modal-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .modal-content::-webkit-scrollbar-thumb {
            background: rgba(253, 187, 45, 0.7);
            border-radius: 4px;
        }
        
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: rgba(253, 187, 45, 0.9);
        }
        
        .modal-header {
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            padding: 20px 30px;
            border-radius: 15px 15px 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 1px solid #555;
        }
        
        .modal h2 {
            margin-bottom: 20px;
            color: #fdbb2d;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .modal-body {
            padding: 0 30px 30px;
        }
        
        .modal label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.2rem;
            text-align: left;
            color: #e0e0e0;
        }
        
        .modal input, .modal select {
            width: 100%;
            padding: 10px;
            font-size: 1.2rem;
            margin-bottom: 20px;
            border-radius: 5px;
            border: 1px solid #555;
            background-color: #444;
            color: white;
            transition: all 0.3s;
        }
        
        .modal input:focus, .modal select:focus {
            outline: none;
            border-color: #fdbb2d;
            box-shadow: 0 0 5px rgba(253, 187, 45, 0.5);
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .modal button {
            min-width: 100px;
            background: linear-gradient(145deg, #fdbb2d, #e6a720);
            color: #333;
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .modal button:hover {
            background: linear-gradient(145deg, #ffc845, #f0b52a);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        
        /* å‡†å¤‡å€’è®¡æ—¶æ ·å¼ */
        .countdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s, visibility 0.5s;
        }
        
        .countdown-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .countdown-number {
            font-size: 20rem;
            color: #fdbb2d;
            text-shadow: 0 0 20px rgba(253, 187, 45, 0.8);
            font-weight: bold;
            animation: pulse 1s infinite;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            text-align: center;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* é˜¶æ®µç¼–è¾‘é¡¹æ ·å¼ - ä¼˜åŒ–ç‰ˆ */
        .phase-edit-item, .tts-edit-item {
            margin-bottom: 15px;
            padding: 15px;
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            border-radius: 10px;
            text-align: left;
            border: 1px solid #444;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .phase-edit-header, .tts-edit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .phase-edit-title, .tts-edit-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #fdbb2d;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .phase-duration-display, .tts-timepoint-display {
            color: #aaa;
            font-weight: normal;
            font-size: 0.9rem;
        }
        
        .toggle-btn {
            background: none;
            border: none;
            color: #fdbb2d;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.3s;
        }
        
        .toggle-btn:hover {
            transform: scale(1.1);
        }
        
        .phase-edit-content, .tts-edit-content {
            margin-top: 15px;
            display: none;
        }
        
        .phase-edit-content.show, .tts-edit-content.show {
            display: block;
        }
        
        .phase-edit-content label, .tts-edit-content label {
            display: block;
            margin-bottom: 5px;
            font-size: 1rem;
            color: #e0e0e0;
        }
        
        .phase-edit-content input, .tts-edit-content input, .tts-edit-content select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #555;
            background-color: #444;
            color: white;
            transition: all 0.3s;
        }
        
        .phase-edit-content input:focus, .tts-edit-content input:focus, .tts-edit-content select:focus {
            outline: none;
            border-color: #fdbb2d;
            box-shadow: 0 0 5px rgba(253, 187, 45, 0.5);
        }
        
        .delete-phase-btn, .delete-tts-btn {
            background: linear-gradient(145deg, #F44336, #d32f2f);
            margin-top: 10px;
            padding: 8px 15px;
            min-width: auto;
            color: white;
        }
        
        /* è¯­éŸ³è®¾ç½®è¡¨æ ¼æ ·å¼ - ä¼˜åŒ–ç‰ˆ */
        .tts-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .tts-table th, .tts-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #444;
        }
        
        .tts-table th {
            background: linear-gradient(145deg, #4a4a4a, #3a3a3a);
            color: #fdbb2d;
            font-weight: bold;
        }
        
        .tts-table tr:last-child td {
            border-bottom: none;
        }
        
        .tts-table input, .tts-table select {
            width: 100%;
            padding: 8px;
            background-color: #444;
            border: 1px solid #555;
            color: white;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .tts-table input:focus, .tts-table select:focus {
            outline: none;
            border-color: #fdbb2d;
            box-shadow: 0 0 5px rgba(253, 187, 45, 0.5);
        }
        
        .tts-table button {
            padding: 6px 12px;
            min-width: auto;
            font-size: 0.9rem;
            background: linear-gradient(145deg, #F44336, #d32f2f);
            color: white;
        }
        
        .add-tts-btn {
            background: linear-gradient(145deg, #4CAF50, #388E3C);
            margin-bottom: 10px;
            color: white;
        }
        
        .tts-voice-controls {
            display: none;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #444;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .tts-voice-controls.show {
            display: flex;
        }
        
        .tts-voice-control {
            flex: 1;
            min-width: 150px;
        }
        
        .tts-voice-control label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #e0e0e0;
        }
        
        .tts-test-btn {
            background: linear-gradient(145deg, #2196F3, #1976D2);
            margin-bottom: 15px;
            color: white;
        }
        
        .toggle-voice-settings-btn {
            background: linear-gradient(145deg, #9C27B0, #7B1FA2);
            margin-bottom: 15px;
            color: white;
        }
        
        /* æŠ¥å‘Šåˆ†ææ¡†æ ·å¼ */
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-size: 1rem; /* é»˜è®¤å­—ä½“å¤§å° */
        }
        
        .report-table th, .report-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #444;
        }
        
        .report-table th {
            background: linear-gradient(145deg, #4a4a4a, #3a3a3a);
            color: #fdbb2d;
            font-weight: bold;
        }
        
        .report-table tr:last-child td {
            border-bottom: none;
        }
        
        .report-summary {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .report-summary p {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .performance-excellent {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .performance-fair {
            color: #FFC107;
            font-weight: bold;
        }
        
        .performance-hard {
            color: #FF9800;
            font-weight: bold;
        }
        
        .performance-extreme {
            color: #F44336;
            font-weight: bold;
        }
        
        .performance-general {
            color: #2196F3;
            font-weight: bold;
        }
        
        .performance-reduced {
            color: #9C27B0;
            font-weight: bold;
        }
        
        .performance-untrained {
            color: #aaa;
            font-weight: bold;
        }
        
        /* åŠ æ—¶/å‡æ—¶æç¤ºæ ·å¼ - ä¿®æ”¹ä¸ºé€æ˜èƒŒæ™¯ */
        .time-adjustment-message {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: #2196F3;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 1001;
            opacity: 0;
            transition: opacity 0.3s;
            white-space: nowrap;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .time-adjustment-message.subtract {
            color: #FF9800;
        }
        
        .time-adjustment-message.show {
            opacity: 1;
        }
        
        /* æ–°å¢æ ·å¼ */
        .report-summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .report-summary-item {
            text-align: center;
            padding: 10px;
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            border-radius: 8px;
            border: 1px solid #444;
        }
        
        .report-summary-item p {
            margin: 5px 0;
        }
        
        .extra-time-red {
            color: #F44336 !important;
        }
        
        .subtract-time-green {
            color: #4CAF50 !important;
        }
        
        .actual-time-purple {
            color: #C678FF !important; /* æ›´äº®çš„ç´«è‰² */
        }
        
        /* æ€»è®¡è¡Œæ ·å¼ - è“è‰²å­—ä½“ï¼ŒèƒŒæ™¯ä¸å…¶ä»–è¡Œä¸€è‡´ */
        .total-row {
            font-weight: bold;
            color: #2196F3 !important; /* è“è‰²å­—ä½“ */
        }
        
        /* çƒŸèŠ±æ•ˆæœæ ·å¼ - ç¡®ä¿æ–‡å­—æ˜¾ç¤º */
        .fireworks-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s, visibility 0.5s;
        }
        
        .fireworks-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .fireworks-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .firework {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #fdbb2d;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: explode 1.5s forwards;
            z-index: 1; /* ç¡®ä¿çƒŸèŠ±åœ¨æ–‡å­—ä¸‹é¢ */
        }
        
        @keyframes explode {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(calc(-50% + var(--x)), calc(-50% + var(--y))) scale(0);
                opacity: 0;
            }
        }
        
        .celebration-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            font-weight: bold;
            color: #fdbb2d;
            text-shadow: 0 0 20px rgba(253, 187, 45, 0.8);
            z-index: 10; /* ç¡®ä¿æ–‡å­—åœ¨çƒŸèŠ±ä¸Šé¢ */
            text-align: center;
            line-height: 1.2;
        }
        
        /* è‡ªå®šä¹‰é€šçŸ¥æ ·å¼ */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .notification {
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-left: 4px solid #fdbb2d;
            max-width: 300px;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.hide {
            opacity: 0;
            transform: translateX(100%);
        }
        
        .notification-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #fdbb2d;
        }
        
        .notification-message {
            font-size: 0.9rem;
        }
        
        /* æ–°å¢ï¼šå†å²è®°å½•æ¨¡æ€æ¡†æ ·å¼ */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-size: 1rem;
        }
        
        .history-table th, .history-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #444;
        }
        
        .history-table th {
            background: linear-gradient(145deg, #4a4a4a, #3a3a3a);
            color: #fdbb2d;
            font-weight: bold;
        }
        
        .history-table tr:last-child td {
            border-bottom: none;
        }
        
        .history-table tr:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .history-actions {
            display: flex;
            gap: 5px;
        }
        
        .history-actions button {
            padding: 5px 10px;
            font-size: 0.8rem;
            min-width: auto;
        }
        
        .empty-history {
            text-align: center;
            padding: 20px;
            color: #aaa;
            font-style: italic;
        }
        
        /* ç¡®è®¤å¯¹è¯æ¡†æ ·å¼ */
        .confirmation-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .confirmation-dialog.active {
            opacity: 1;
            visibility: visible;
        }
        
        .confirmation-content {
            background: linear-gradient(145deg, #2c2c2c, #1f1f1f);
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 1px solid #444;
        }
        
        .confirmation-content h3 {
            margin-bottom: 20px;
            color: #fdbb2d;
        }
        
        .confirmation-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .confirmation-buttons button {
            min-width: 80px;
        }
        
        .confirm-btn {
            background: linear-gradient(145deg, #4CAF50, #388E3C);
            color: white;
        }
        
        .cancel-btn {
            background: linear-gradient(145deg, #F44336, #d32f2f);
            color: white;
        }
        
        /* é˜¶æ®µå®Œæˆç¡®è®¤å¯¹è¯æ¡†æ ·å¼ */
        .phase-completion-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .phase-completion-dialog.active {
            opacity: 1;
            visibility: visible;
        }
        
        .phase-completion-content {
            background: linear-gradient(145deg, #2c2c2c, #1f1f1f);
            border-radius: 15px;
            width: 90%;
            max-width: 450px;
            text-align: center;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 1px solid #444;
        }
        
        .phase-completion-content h3 {
            margin-bottom: 15px;
            color: #fdbb2d;
        }
        
        .phase-completion-content p {
            margin-bottom: 20px;
            color: #e0e0e0;
        }
        
        .phase-completion-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .phase-completion-buttons button {
            min-width: 100px;
        }
        
        .complete-btn {
            background: linear-gradient(145deg, #4CAF50, #388E3C);
            color: white;
        }
        
        .add-time-btn {
            background: linear-gradient(145deg, #2196F3, #1976D2);
            color: white;
        }
        
        /* å¤åˆ¶æŒ‰é’®æ ·å¼ */
        .copy-log-btn {
            background: linear-gradient(145deg, #2196F3, #1976D2);
            color: white;
            margin-top: 10px;
        }
        
        /* å†å²è®°å½•æŒ‰é’®æ ·å¼ */
        .history-btn {
            background: linear-gradient(145deg, #9C27B0, #7B1FA2);
            color: white;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                border-radius: 15px;
            }
            
            h1 {
                font-size: 2rem;
            }
            .startTimeLeft {
                display: none;
            }
            .endTimeRight {
                display: none;
            }
            .timer-status-container {
                flex-direction: row;
                gap: 10px;
            }
            
            .timer-status {
                font-size: 1.2rem;
                padding: 8px;
            }
            
            .progress-indicator {
                margin-top: 5px;
            }
            
            .next-phase-indicator {
                margin-top: 5px;
                text-align: center;
            }
            
            .phase-info {
                flex-direction: column;
                height: auto;
            }
            
            .phase-left, .phase-right {
                width: 100%;
                height: auto;
            }
            
            .phase-name {
                font-size: 1.8rem;
            }
            
            .phase-timer {
                font-size: 8.5rem;
            }
            
            .completion-message {
                font-size: 2.5rem;
            }
            
            .total-timer-container {
                flex-direction: column;
                gap: 5px;
            }
            
            .total-timer {
                font-size: 2rem;
                order: -1;
            }
            
            .start-time, .end-time {
                font-size: 1rem;
                width: 100%;
                text-align: center;
            }
            
            /* ç§»åŠ¨ç«¯æ—¶é—´æ˜¾ç¤ºåœ¨ä¸€è¡Œ */
            .time-row {
                display: flex;
                justify-content: space-between;
                width: 100%;
                margin-top: 5px;
            }
            
            button {
                padding: 8px 12px; /* ç§»åŠ¨ç«¯æŒ‰é’®æ›´å° */
                font-size: 0.9rem;
                min-width: 80px;
            }
            
            .settings-btn {
                min-width: 10px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .main-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            /* ç§»åŠ¨ç«¯å€’è®¡æ—¶å­—ä½“å¤§å°è°ƒæ•´ */
            .countdown-number {
                font-size: 15rem;
            }
            
            /* ç§»åŠ¨ç«¯è®¾ç½®æŒ‰é’®ä½ç½®è°ƒæ•´ - ç¡®ä¿å·¦ä¸Šè§’å’Œå³ä¸Šè§’ */
            .settings-buttons {
                position: absolute;
                top: 15px;
                left: 15px;
            }
            
            .top-right-buttons {
                position: absolute;
                top: 15px;
                right: 15px;
            }
            
            /* ç§»åŠ¨ç«¯æ¨¡æ€æ¡†è°ƒæ•´ */
            .modal-content {
                padding: 0;
            }
            
            .modal-header {
                padding: 15px 20px;
            }
            
            .modal-body {
                padding: 0 20px 20px;
            }
            
            .modal-buttons {
                flex-wrap: wrap;
            }
            
            .tts-voice-controls {
                flex-direction: column;
            }
            
            /* ç§»åŠ¨ç«¯è½®ç›˜å¯¼èˆªæŒ‰é’®éšè—å‚ç›´æ–¹å‘ï¼Œæ˜¾ç¤ºæ°´å¹³æ–¹å‘ */
            .carousel-nav-vertical {
                display: none;
            }
            
            .carousel-nav {
                display: block;
            }
            
            /* ç§»åŠ¨ç«¯æŠ¥å‘Šæ‘˜è¦ç½‘æ ¼ */
            .report-summary-grid {
                grid-template-columns: 1fr;
            }
            
            /* ç§»åŠ¨ç«¯æŠ¥å‘Šæ‘˜è¦é¡¹å†…åç§°å’Œæ—¶é—´åœ¨åŒä¸€è¡Œ */
            .report-summary-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                text-align: left;
            }
            
            .report-summary-item p {
                margin: 0;
            }
            
            /* ç§»åŠ¨ç«¯åº†ç¥æ–‡å­— */
            .celebration-text {
                font-size: 2.5rem;
            }
            
            /* ç§»åŠ¨ç«¯é€šçŸ¥æ ·å¼ */
            .notification-container {
                top: 10px;
                right: 10px;
                left: 10px;
                align-items: center;
            }
            
            .notification {
                max-width: 100%;
            }
            
            /* ç§»åŠ¨ç«¯æŠ¥å‘Šè¡¨æ ¼å­—ä½“ç¼©å° */
            .report-table {
                font-size: 0.8rem; /* ç§»åŠ¨ç«¯å­—ä½“æ›´å° */
            }
            
            .report-table th, .report-table td {
                padding: 8px 10px; /* ç§»åŠ¨ç«¯å†…è¾¹è·æ›´å° */
            }
            
            /* ç§»åŠ¨ç«¯å†å²è®°å½•è¡¨æ ¼å­—ä½“ç¼©å° */
            .history-table {
                font-size: 0.8rem;
            }
            
            .history-table th, .history-table td {
                padding: 8px 10px;
            }
            
            .history-actions {
                flex-direction: column;
                gap: 3px;
            }
            
            .history-actions button {
                padding: 3px 6px;
                font-size: 0.7rem;
            }
            
            .confirmation-content, .phase-completion-content {
                padding: 20px;
            }
        }
        
        @media (min-width: 769px) {
            /* æ¡Œé¢ç«¯è½®ç›˜å¯¼èˆªæŒ‰é’®éšè—æ°´å¹³æ–¹å‘ï¼Œæ˜¾ç¤ºå‚ç›´æ–¹å‘ */
            .carousel-nav {
                display: none;
            }
            
            .carousel-nav-vertical {
                display: flex;
            }
            
            .phase-carousel-track {
                flex-direction: column;
                height: 100%;
            }
            
            .phase-carousel-item {
                flex: 0 0 100%;
                height: 100%;
            }
            
            /* å®½å±æ—¶ï¼Œå¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´åˆ†åˆ«åœ¨æ€»æ—¶é—´çš„å·¦è¾¹å’Œå³è¾¹ */
            .total-timer-container {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .start-time {
                text-align: left;
                flex: 1;
            }
            
            .end-time {
                text-align: right;
                flex: 1;
            }
            
            .total-timer {
                flex: 2;
                text-align: center;
            }
            
            /* ç§»é™¤ç§»åŠ¨ç«¯çš„æ—¶é—´è¡Œæ ·å¼ */
            .time-row {
                display: none;
            }
            
            /* å®½å±ä¸‹è°ƒæ•´æ—¶é—´è°ƒæ•´æç¤ºçš„ä½ç½® - é è¿‘å€’è®¡æ—¶æ•°å­— */
            .time-adjustment-message {
                top: 30px; /* è°ƒæ•´ä½ç½®ï¼Œä½¿å…¶æ›´é è¿‘å€’è®¡æ—¶æ•°å­— */
            }
        }
        
        @media (max-width: 480px) {
            .phase-timer {
                font-size: 5rem;
            }
            .startTimeLeft {
                display: none;
            }
            .endTimeRight {
                display: none;
            }
            
            .completion-message {
                font-size: 2rem;
            }
            
            .countdown-number {
                font-size: 12rem;
            }
            
            .phase-name {
                font-size: 1.5rem;
            }
            
            .phase-description {
                font-size: 0.9rem;
            }
            
            .total-timer {
                font-size: 1.8rem;
            }
            
            .controls {
                gap: 10px;
            }
            
            .main-controls {
                gap: 10px;
            }
            
            button {
                padding: 8px 10px; /* è¶…å°å±å¹•æŒ‰é’®æ›´å° */
                min-width: 70px;
                font-size: 0.8rem;
            }
            
            .settings-btn {
                min-width: 10px;
            }
            
            .start-time, .end-time {
                font-size: 0.9rem;
            }
            
            .tts-table {
                font-size: 0.8rem;
            }
            
            .tts-table th, .tts-table td {
                padding: 5px;
            }
            
            .celebration-text {
                font-size: 2rem;
            }
            
            /* è¶…å°å±å¹•æŠ¥å‘Šè¡¨æ ¼å­—ä½“æ›´å° */
            .report-table {
                font-size: 0.7rem;
            }
            
            .report-table th, .report-table td {
                padding: 5px 8px;
            }
            
            /* è¶…å°å±å¹•å†å²è®°å½•è¡¨æ ¼å­—ä½“æ›´å° */
            .history-table {
                font-size: 0.7rem;
            }
            
            .history-table th, .history-table td {
                padding: 5px 8px;
            }
        }
    </style>
</head>
<body>
    <!-- è‡ªå®šä¹‰é€šçŸ¥å®¹å™¨ -->
    <div class="notification-container" id="notificationContainer"></div>
    
    <!-- ç¡®è®¤å¯¹è¯æ¡† -->
    <div class="confirmation-dialog" id="resetConfirmationDialog">
        <div class="confirmation-content">
            <h3>ç¡®è®¤é‡ç½®</h3>
            <p>æ‚¨ç¡®å®šè¦é‡ç½®å½“å‰è¿åŠ¨è®¡æ—¶å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰è®¡æ—¶æ•°æ®ã€‚</p>
            <div class="confirmation-buttons">
                <button class="confirm-btn" id="confirmResetBtn">ç¡®å®š</button>
                <button class="cancel-btn" id="cancelResetBtn">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <div class="confirmation-dialog" id="finishConfirmationDialog">
        <div class="confirmation-content">
            <h3>ç¡®è®¤ç»“æŸ</h3>
            <p>æ‚¨ç¡®å®šè¦ç»“æŸå½“å‰è¿åŠ¨è®¡æ—¶å—ï¼Ÿè¿™å°†ç”Ÿæˆè¿åŠ¨æŠ¥å‘Šã€‚</p>
            <div class="confirmation-buttons">
                <button class="confirm-btn" id="confirmFinishBtn">ç¡®å®š</button>
                <button class="cancel-btn" id="cancelFinishBtn">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- é˜¶æ®µå®Œæˆç¡®è®¤å¯¹è¯æ¡† -->
    <div class="phase-completion-dialog" id="phaseCompletionDialog">
        <div class="phase-completion-content">
            <h3 id="phaseCompletionTitle">é˜¶æ®µå®Œæˆç¡®è®¤</h3>
            <p id="phaseCompletionMessage">æ‚¨æ˜¯å¦å·²å®Œæˆå½“å‰é˜¶æ®µçš„è®­ç»ƒï¼Ÿ</p>
            <div class="phase-completion-buttons">
                <button class="complete-btn" id="completePhaseBtn">æ˜¯ï¼Œå·²å®Œæˆ</button>
                <button class="add-time-btn" id="addTimePhaseBtn">å¦ï¼ŒåŠ æ—¶1åˆ†é’Ÿ</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="settings-buttons">
            <button class="settings-btn" id="editPhasesBtn" title="ç¼–è¾‘é˜¶æ®µ">âœï¸</button>
        </div>
        
        <div class="top-right-buttons">
            <button class="settings-btn" id="ttsSettingsBtn" title="è¯­éŸ³è®¾ç½®">ğŸ”Š</button>
            <button class="settings-btn" id="historyBtn" title="å†å²è®°å½•">ğŸ“‹</button>
        </div>
        
        <div class="current-time" id="currentTime">å½“å‰æ—¶é—´: --:--:--</div>
        
        <div class="timer-status-container">
            <div class="timer-status" id="timerStatus">æœªå¼€å§‹</div>
            <div class="progress-indicator" id="progressIndicator">1/7</div>
            <div class="next-phase-indicator" id="nextPhaseIndicator">â†’ä¼‘æ¯æ—¶é—´</div>
        </div>
        
        <div class="phase-info">
            <div class="phase-left">
                <div class="phase-carousel">
                    <button class="carousel-nav carousel-prev" id="carouselPrev">â—€</button>
                    <button class="carousel-nav carousel-next" id="carouselNext">â–¶</button>
                    
                    <button class="carousel-nav-vertical carousel-prev-vertical" id="carouselPrevVertical">â–²</button>
                    <button class="carousel-nav-vertical carousel-next-vertical" id="carouselNextVertical">â–¼</button>
                    
                    <div class="phase-carousel-track" id="phaseCarouselTrack">
                        <!-- é˜¶æ®µå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <div class="phase-right">
                <!-- æ—¶é—´è°ƒæ•´æç¤º -->
                <div class="time-adjustment-message" id="timeAdjustmentMessage"></div>
                
                <div class="phase-timer" id="phaseTimer">00:00</div>
                <div class="phase-timer-label">é˜¶æ®µå€’è®¡æ—¶</div>
            </div>
        </div>
        
        <div class="total-timer-container">
            <div class="start-time startTimeLeft" id="startTime">å¼€å§‹æ—¶é—´: --:--:--</div>
            <div class="total-timer" id="totalTimer">æ€»æ—¶é—´: 00:00:00</div>
            <div class="end-time endTimeRight" id="endTime">ç»“æŸæ—¶é—´: --:--:--</div>
            <!-- ç§»åŠ¨ç«¯ä½¿ç”¨çš„æ—¶é—´è¡Œ -->
            <div class="time-row">
                <div class="start-time" id="startTimeMobile">å¼€å§‹æ—¶é—´: --:--:--</div>
                <div class="end-time" id="endTimeMobile">ç»“æŸæ—¶é—´: --:--:--</div>
            </div>
        </div>
        
        <div class="controls">
            <div class="main-controls">
                <!-- å‡æ—¶æŒ‰é’®åœ¨å¼€å§‹æŒ‰é’®å·¦è¾¹ -->
                <button id="subtractTimeBtn" disabled title="å‡æ—¶1åˆ†é’Ÿ">å‡æ—¶</button>
                <button id="startBtn">å¼€å§‹</button>
                <!-- åŠ æ—¶æŒ‰é’®åœ¨å¼€å§‹æŒ‰é’®å³è¾¹ -->
                <button id="addTimeBtn" disabled title="åŠ æ—¶1åˆ†é’Ÿ">åŠ æ—¶</button>
                <button id="pauseBtn" disabled>æš‚åœ</button>
                <button id="resetBtn" disabled>é‡ç½®</button>
                <button id="finishBtn" disabled title="ç»“æŸè®­ç»ƒå¹¶ç”ŸæˆæŠ¥å‘Š">ç»“æŸ</button>
            </div>
        </div>
        
    </div>

    <!-- å‡†å¤‡å€’è®¡æ—¶è¦†ç›–å±‚ -->
    <div class="countdown-overlay" id="countdownOverlay">
        <div class="countdown-number" id="countdownNumber">3</div>
    </div>

    <!-- çƒŸèŠ±åº†ç¥æ•ˆæœ -->
    <div class="fireworks-overlay" id="fireworksOverlay">
        <div class="fireworks-container" id="fireworksContainer"></div>
        <div class="celebration-text">æ­å–œå®Œæˆè®­ç»ƒï¼å¤ªæ£’å•¦ï¼</div>
    </div>

    <!-- ç¼–è¾‘é˜¶æ®µæ¨¡æ€æ¡† -->
    <div class="modal" id="editPhasesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ç¼–è¾‘è®­ç»ƒé˜¶æ®µ</h2>
                <div class="modal-buttons">
                    <button id="addPhaseBtn">æ·»åŠ é˜¶æ®µ</button>
                    <button id="savePhasesBtn">ä¿å­˜</button>
                    <button id="cancelPhasesEditBtn">å–æ¶ˆ</button>
                </div>
            </div>
            <div class="modal-body">
                <div id="phasesEditContainer">
                    <!-- é˜¶æ®µç¼–è¾‘å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- è¯­éŸ³è®¾ç½®æ¨¡æ€æ¡† -->
    <div class="modal" id="ttsSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>è¯­éŸ³æç¤ºè®¾ç½®</h2>
                <div class="modal-buttons">
                    <button id="toggleVoiceSettingsBtn" class="toggle-voice-settings-btn">æ˜¾ç¤ºè¯­éŸ³è®¾ç½®</button>
                    <button id="addTtsBtn">æ·»åŠ è¯­éŸ³æç¤º</button>
                    <button id="saveTtsBtn">ä¿å­˜</button>
                    <button id="cancelTtsBtn">å–æ¶ˆ</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="tts-voice-controls" id="ttsVoiceControls">
                    <div class="tts-voice-control">
                        <label for="ttsVoice">éŸ³è‰²:</label>
                        <select id="ttsVoice">
                            <option value="">é»˜è®¤éŸ³è‰²</option>
                        </select>
                    </div>
                    <div class="tts-voice-control">
                        <label for="ttsPitch">éŸ³è°ƒ (0.5-2):</label>
                        <input type="range" id="ttsPitch" min="0.5" max="2" step="0.1" value="1">
                        <span id="ttsPitchValue">1.0</span>
                    </div>
                    <div class="tts-voice-control">
                        <label for="ttsRate">è¯­é€Ÿ (0.5-2):</label>
                        <input type="range" id="ttsRate" min="0.5" max="2" step="0.1" value="1">
                        <span id="ttsRateValue">1.0</span>
                    </div>
                    <div class="tts-voice-control">
                        <button id="ttsTestBtn" class="tts-test-btn">æµ‹è¯•è¯­éŸ³</button>
                    </div>
                </div>
                
                <p>è®¾ç½®åœ¨ä¸åŒé˜¶æ®µå’Œæ—¶é—´ç‚¹æ’­æ”¾çš„è¯­éŸ³æç¤º</p>
                
                <div id="ttsEditContainer">
                    <!-- è¯­éŸ³æç¤ºç¼–è¾‘å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- æŠ¥å‘Šåˆ†ææ¨¡æ€æ¡† -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="reportTitle">è¿åŠ¨æ‰§è¡Œæƒ…å†µæŠ¥å‘Š</h2>
            </div>
            <div class="modal-body">
                <div class="report-summary">
                    <div class="report-summary-grid">
                        <div class="report-summary-item">
                            <p><strong>å¼€å§‹æ—¶é—´:</strong></p>
                            <p id="reportStartTime">--:--:--</p>
                        </div>
                        <div class="report-summary-item">
                            <p><strong>ç»“æŸæ—¶é—´:</strong></p>
                            <p id="reportEndTime">--:--:--</p>
                        </div>
                        <div class="report-summary-item">
                            <p><strong>è¿åŠ¨è®¡åˆ’æ—¶é—´:</strong></p>
                            <p id="reportPlannedTime">00:00:00</p>
                        </div>
                        <div class="report-summary-item">
                            <p><strong>å®é™…è¿åŠ¨æ—¶é—´:</strong></p>
                            <p id="reportActualTime" class="actual-time-purple">00:00:00</p>
                        </div>
                    </div>
                </div>
                
                <table class="report-table" id="reportTable">
                    <thead>
                        <tr>
                            <th>é˜¶æ®µåç§°</th>
                            <th>è®¡åˆ’ç”¨æ—¶</th>
                            <th>å®é™…ç”¨æ—¶</th>
                            <th>åŠ æ—¶æ—¶é—´</th>
                            <th>å‡æ—¶æ—¶é—´</th>
                            <th>æš‚åœæ—¶é—´</th>
                            <th>å®Œæˆç¨‹åº¦</th>
                        </tr>
                    </thead>
                    <tbody id="reportTableBody">
                        <!-- æŠ¥å‘Šå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
                
                <div class="modal-buttons">
                    <button id="copyLogBtn" class="copy-log-btn">å¤åˆ¶æœ¬æ¬¡æ—¥å¿—</button>
                    <button id="closeReportBtn">é‡ç½®</button>
                </div>
            </div>
        </div>
    </div>

    <!-- å†å²è®°å½•æ¨¡æ€æ¡† -->
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>è¿åŠ¨å†å²è®°å½•</h2>
            </div>
            <div class="modal-body">
                <div id="historyContainer">
                    <table class="history-table" id="historyTable">
                        <thead>
                            <tr>
                                <th>æ—¥æœŸ</th>
                                <th>å¼€å§‹æ—¶é—´</th>
                                <th>ç»“æŸæ—¶é—´</th>
                                <th>å®é™…ç”¨æ—¶</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <!-- å†å²è®°å½•å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                    <div class="empty-history" id="emptyHistoryMessage" style="display: none;">
                        æš‚æ— å†å²è®°å½•
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button id="closeHistoryBtn">å…³é—­</button>
                    <button id="clearHistoryBtn" class="delete-phase-btn">æ¸…ç©ºè®°å½•</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å®šä¹‰è®­ç»ƒé˜¶æ®µ - å·²ç§»é™¤è®­ç»ƒå®Œæˆé˜¶æ®µ
        const phases = [
            { name: "çƒ­èº«é˜¶æ®µ", duration: 15 * 60, description: "å‡†å¤‡æ´»åŠ¨ï¼Œæé«˜å¿ƒç‡" },
            { name: "ä¼‘æ¯æ—¶é—´", duration: 2 * 60, description: "çŸ­æš‚ä¼‘æ¯" },
            { name: "æ‹³å‡»è®­ç»ƒ", duration: 30 * 60, description: "é«˜å¼ºåº¦æ‹³å‡»ç»ƒä¹ " },
            { name: "ä¼‘æ¯æ—¶é—´", duration: 3 * 60, description: "æ¢å¤ä½“åŠ›" },
            { name: "åŠ›é‡è®­ç»ƒ", duration: 30 * 60, description: "å¢å¼ºè‚Œè‚‰åŠ›é‡" },
            { name: "ä¼‘æ¯æ—¶é—´", duration: 2 * 60, description: "çŸ­æš‚ä¼‘æ¯" },
            { name: "æ”¾æ¾æ‹‰ä¼¸", duration: 10 * 60, description: "ç¼“è§£è‚Œè‚‰ç´§å¼ " }
        ];

        // å®šä¹‰æ–‡æœ¬è½¬è¯­éŸ³è®¾ç½®
        let ttsSettings = [
            // çƒ­èº«é˜¶æ®µæé†’
            { phaseId: 0, timePoint: 10, text: "çƒ­èº«é˜¶æ®µå³å°†ç»“æŸï¼Œè¯·å‡†å¤‡ä¼‘æ¯" },
            { phaseId: 0, timePoint: 899, text: "ä½¿ç”¨å¼€åˆè·³æˆ–è€…è·³ç»³æ¥è¿›è¡Œåˆå§‹çƒ­èº«" },
            { phaseId: 0, timePoint: 720, text: "è¿›è¡ŒåŠ¨æ€æ‹‰ä¼¸ã€é«˜æŠ¬è…¿ã€åè¸¢è…¿ç­‰åŠ¨ä½œ" },
            { phaseId: 0, timePoint: 180, text: "æœ€åä¸‰åˆ†é’Ÿå¿«é€Ÿç¢æ­¥ã€é«˜æŠ¬è…¿è¿›è¡Œç¥ç»æ¿€æ´»" },
            // ä¼‘æ¯é˜¶æ®µæé†’
            { phaseId: 1, timePoint: 10, text: "ä¼‘æ¯é˜¶æ®µå³å°†ç»“æŸï¼Œè¯·å‡†å¤‡æ‹³å‡»è®­ç»ƒ" },
            { phaseId: 1, timePoint: 119, text: "å¿«é€Ÿè¡¥æ°´ï¼Œè°ƒæ•´æ‰‹ç»·å¸¦ï¼Œå¿ƒç†å‡†å¤‡è¿›å…¥æ‹³å‡»çŠ¶æ€ã€‚" },
            { phaseId: 3, timePoint: 10, text: "ä¼‘æ¯é˜¶æ®µå³å°†ç»“æŸï¼Œè¯·å‡†å¤‡åŠ›é‡è®­ç»ƒ" },
            { phaseId: 3, timePoint: 179, text: "å……åˆ†è¡¥æ°´ï¼Œæ“¦æ±—ï¼Œæ·±å‘¼å¸è®©å¿ƒç‡ç¨ä½œå›è½ï¼Œä¸ºåŠ›é‡è®­ç»ƒåšå‡†å¤‡ã€‚" },
            { phaseId: 5, timePoint: 10, text: "ä¼‘æ¯é˜¶æ®µå³å°†ç»“æŸï¼Œè¯·å‡†å¤‡æ”¾æ¾æ‹‰ä¼¸" },
            { phaseId: 5, timePoint: 119, text: "æ‹¿å–ç­‹è†œæªã€é“ºå«å­ï¼Œå‡†å¤‡è¿›è¡Œæœ€åæ”¾æ¾ã€‚" },
            //æ‹³å‡»é˜¶æ®µå†…æé†’
            { phaseId: 2, timePoint: 10, text: "æ‹³å‡»è®­ç»ƒé˜¶æ®µå³å°†ç»“æŸï¼Œè¯·å‡†å¤‡ä¼‘æ¯" },
            { phaseId: 2, timePoint: 1799, text: "å…ˆè¿›è¡Œä¸€åˆ†é’Ÿé™æ­¢åŸºæœ¬å§¿åŠ¿" },
            { phaseId: 2, timePoint: 1740, text: "è¿›è¡Œå‰åå·¦å³æ»‘æ­¥å„ä¸€åˆ†é’Ÿ" },
            { phaseId: 2, timePoint: 1650, text: "æ³¨æ„ï¼Œè´¨é‡å¤§äºæ•°é‡ï¼Œä¿æŒåŠ¨ä½œæ ‡å‡†" },
            { phaseId: 2, timePoint: 1500, text: "è¿›è¡ŒæŠ€æœ¯æ‰“ç£¨ï¼Œä»Šå¤©æ˜¯æ‘†æ‹³ï¼Œå‰åæ‰‹å‡»å¤´å„äº”åæ¬¡" },
            { phaseId: 2, timePoint: 1300, text: "æ³¨æ„ï¼Œè´¨é‡å¤§äºæ•°é‡ï¼Œä¿æŒåŠ¨ä½œæ ‡å‡†" },
            { phaseId: 2, timePoint: 600, text: "æ‹³å‡»è®­ç»ƒé˜¶æ®µè¿˜å‰©ååˆ†é’Ÿ" },
            { phaseId: 2, timePoint: 300, text: "ç»“åˆæ­¥æ³•ï¼Œç§»åŠ¨å‡ºæ‹³" },
            { phaseId: 2, timePoint: 150, text: "æ³¨æ„ï¼Œè´¨é‡å¤§äºæ•°é‡ï¼Œä¿æŒåŠ¨ä½œæ ‡å‡†" },
            // åŠ›é‡è®­ç»ƒé˜¶æ®µå†…æé†’
            { phaseId: 4, timePoint: 10, text: "åŠ›é‡è®­ç»ƒé˜¶æ®µå³å°†ç»“æŸï¼Œè¯·å‡†å¤‡ä¼‘æ¯" },
            { phaseId: 4, timePoint: 1799, text: "å‡†å¤‡ä¸€ç»„åŠ›ç«­å‡»æŒä¿¯å§æ’‘" },
            { phaseId: 4, timePoint: 1770, text: "å‡†å¤‡äºŒç»„åŠ›ç«­å‡»æ‹³ä¿¯å§æ’‘" },
            { phaseId: 4, timePoint: 1500, text: "å‡†å¤‡ä¸‰ç»„è‡ªé‡æ·±è¹²20æ¬¡" },
            { phaseId: 4, timePoint: 1200, text: "å‡†å¤‡è…¹è‚Œæ ¸å¿ƒè®­ç»ƒ" },
            { phaseId: 4, timePoint: 600, text: "åŠ›é‡è®­ç»ƒé˜¶æ®µè¿˜å‰©10åˆ†é’Ÿ" },
            // æ”¾æ¾æ‹‰ä¼¸é˜¶æ®µå†…æé†’
            { phaseId: 6, timePoint: 10, text: "æ”¾æ¾æ‹‰ä¼¸é˜¶æ®µå³å°†ç»“æŸï¼Œè®­ç»ƒå³å°†å®Œæˆ" },
            { phaseId: 6, timePoint: 599, text: "ç­‹è†œæªé‡ç‚¹æ”¾æ¾è‚©ã€æ‰‹è‡‚ã€èƒ¸ã€èƒŒã€è…¿ï¼Œæ²¿ç€è‚Œè‚‰çš„ç”Ÿé•¿èµ°å‘ç¼“æ…¢ç§»åŠ¨ï¼Œä¸è¦æ¥å›èƒ¡ä¹±éœ‡åŠ¨ã€‚" },
            { phaseId: 6, timePoint: 540, text: "æ–½åŠ ç¨³å®šã€é€‚åº¦çš„å‹åŠ›ï¼Œä»¥æ„Ÿè§‰åˆ°è‚Œè‚‰æ·±å¤„æœ‰éœ‡åŠ¨æ„Ÿä¸ºå®œã€‚" },
            { phaseId: 6, timePoint: 480, text: "ä»¥æ¯ç§’2-4å˜ç±³çš„é€Ÿåº¦ç¼“æ…¢ç§»åŠ¨ï¼Œåœ¨ç‰¹åˆ«é…¸ç—›çš„æ¿€ç—›ç‚¹ä¸Šå¯ä»¥åœç•™10-30ç§’ã€‚" },
            { phaseId: 6, timePoint: 420, text: "å°½é‡è®©æŒ‰æ‘©å¤´ä¸è‚Œè‚‰è¡¨é¢ä¿æŒ90åº¦å‚ç›´ï¼Œä»¥ç¡®ä¿åŠ›é‡èƒ½æœ‰æ•ˆä¼ å¯¼è‡³æ·±å±‚ã€‚" },
            { phaseId: 6, timePoint: 300, text: "æ”¾æ¾æ‹‰ä¼¸é˜¶æ®µè¿˜å‰©5åˆ†é’Ÿ" },
            { phaseId: 6, timePoint: 280, text: "é™æ€æ‹‰ä¼¸ï¼š èƒ¸ã€è‚©ã€æ‰‹è‡‚ã€èƒŒéƒ¨ã€å¤§è…¿ã€è‡€ã€å°è…¿ã€é«‹" },
            { phaseId: 6, timePoint: 230, text: "ç¼“æ…¢åœ°è¿›å…¥æ‹‰ä¼¸å§¿åŠ¿ï¼Œé¿å…ç”¨çˆ†å‘åŠ›å¼¹éœ‡ã€‚" },
            { phaseId: 6, timePoint: 205, text: "æ‹‰ä¼¸åˆ°æ„Ÿè§‰è‚Œè‚‰æœ‰è½»å¾®çš„ã€èˆ’é€‚çš„ç‰µæ‹‰æ„Ÿå³å¯ï¼Œç»ä¸æ˜¯å‰§ç—›ã€‚" },
            { phaseId: 6, timePoint: 255, text: "åœ¨æ¯ä¸ªå§¿åŠ¿ä¿æŒ20-30ç§’ï¼ŒæœŸé—´è¿›è¡Œæ·±é•¿è€Œç¼“æ…¢çš„å‘¼å¸ï¼Œç”¨å‘¼æ°”æ¥å¸®åŠ©èº«ä½“æ›´æ·±åœ°æ”¾æ¾ã€‚" },
            { phaseId: 6, timePoint: 180, text: "ä¸¤ä¾§èº«ä½“éƒ½è¦æ‹‰ä¼¸ï¼Œæ—¶é—´ä¿æŒä¸€è‡´ã€‚" },

            // è¿˜å‰©1åˆ†é’Ÿè¯­éŸ³æç¤º
            { phaseId: 0, timePoint: 60, text: "çƒ­èº«é˜¶æ®µè¿˜å‰©1åˆ†é’Ÿ" },
            { phaseId: 1, timePoint: 60, text: "ä¼‘æ¯æ—¶é—´è¿˜å‰©1åˆ†é’Ÿ" },
            { phaseId: 2, timePoint: 60, text: "æ‹³å‡»è®­ç»ƒé˜¶æ®µè¿˜å‰©1åˆ†é’Ÿ" },
            { phaseId: 3, timePoint: 60, text: "ä¼‘æ¯æ—¶é—´è¿˜å‰©1åˆ†é’Ÿ" },
            { phaseId: 4, timePoint: 60, text: "åŠ›é‡è®­ç»ƒé˜¶æ®µè¿˜å‰©1åˆ†é’Ÿ" },
            { phaseId: 5, timePoint: 60, text: "ä¼‘æ¯è¿˜å‰©1åˆ†é’Ÿ" },
            { phaseId: 6, timePoint: 60, text: "æ”¾æ¾æ‹‰ä¼¸é˜¶æ®µè¿˜å‰©1åˆ†é’Ÿ" },
        ];

        // è·å–DOMå…ƒç´ 
        const currentTimeElement = document.getElementById('currentTime');
        const timerStatusElement = document.getElementById('timerStatus');
        const progressIndicatorElement = document.getElementById('progressIndicator');
        const nextPhaseIndicatorElement = document.getElementById('nextPhaseIndicator');
        const totalTimerElement = document.getElementById('totalTimer');
        const phaseTimerElement = document.getElementById('phaseTimer');
        const subtractTimeBtn = document.getElementById('subtractTimeBtn');
        const addTimeBtn = document.getElementById('addTimeBtn');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const finishBtn = document.getElementById('finishBtn');
        const startTimeElement = document.getElementById('startTime');
        const endTimeElement = document.getElementById('endTime');
        const startTimeMobileElement = document.getElementById('startTimeMobile');
        const endTimeMobileElement = document.getElementById('endTimeMobile');
        
        // è½®ç›˜å…ƒç´ 
        const phaseCarouselTrack = document.getElementById('phaseCarouselTrack');
        const carouselPrev = document.getElementById('carouselPrev');
        const carouselNext = document.getElementById('carouselNext');
        const carouselPrevVertical = document.getElementById('carouselPrevVertical');
        const carouselNextVertical = document.getElementById('carouselNextVertical');
        
        // è®¾ç½®æŒ‰é’®å…ƒç´ 
        const editPhasesBtn = document.getElementById('editPhasesBtn');
        const ttsSettingsBtn = document.getElementById('ttsSettingsBtn');
        const historyBtn = document.getElementById('historyBtn');
        
        // æ¨¡æ€æ¡†ç›¸å…³å…ƒç´ 
        const editPhasesModal = document.getElementById('editPhasesModal');
        const ttsSettingsModal = document.getElementById('ttsSettingsModal');
        const reportModal = document.getElementById('reportModal');
        const historyModal = document.getElementById('historyModal');
        const phasesEditContainer = document.getElementById('phasesEditContainer');
        const ttsEditContainer = document.getElementById('ttsEditContainer');
        
        // æ¨¡æ€æ¡†æŒ‰é’®
        const addPhaseBtn = document.getElementById('addPhaseBtn');
        const savePhasesBtn = document.getElementById('savePhasesBtn');
        const cancelPhasesEditBtn = document.getElementById('cancelPhasesEditBtn');
        const addTtsBtn = document.getElementById('addTtsBtn');
        const saveTtsBtn = document.getElementById('saveTtsBtn');
        const cancelTtsBtn = document.getElementById('cancelTtsBtn');
        const closeReportBtn = document.getElementById('closeReportBtn');
        const copyLogBtn = document.getElementById('copyLogBtn');
        const closeHistoryBtn = document.getElementById('closeHistoryBtn');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        
        // è¯­éŸ³è®¾ç½®å…ƒç´ 
        const ttsVoiceControls = document.getElementById('ttsVoiceControls');
        const toggleVoiceSettingsBtn = document.getElementById('toggleVoiceSettingsBtn');
        const ttsVoice = document.getElementById('ttsVoice');
        const ttsPitch = document.getElementById('ttsPitch');
        const ttsPitchValue = document.getElementById('ttsPitchValue');
        const ttsRate = document.getElementById('ttsRate');
        const ttsRateValue = document.getElementById('ttsRateValue');
        const ttsTestBtn = document.getElementById('ttsTestBtn');
        
        // æ–°å¢ï¼šå‡†å¤‡å€’è®¡æ—¶å…ƒç´ 
        const countdownOverlay = document.getElementById('countdownOverlay');
        const countdownNumber = document.getElementById('countdownNumber');
        
        // æ–°å¢ï¼šæ—¶é—´è°ƒæ•´æç¤ºå…ƒç´ 
        const timeAdjustmentMessage = document.getElementById('timeAdjustmentMessage');
        
        // æ–°å¢ï¼šçƒŸèŠ±åº†ç¥å…ƒç´ 
        const fireworksOverlay = document.getElementById('fireworksOverlay');
        const fireworksContainer = document.getElementById('fireworksContainer');
        
        // æ–°å¢ï¼šæŠ¥å‘Šæ ‡é¢˜å…ƒç´ 
        const reportTitle = document.getElementById('reportTitle');
        
        // æ–°å¢ï¼šé€šçŸ¥å®¹å™¨
        const notificationContainer = document.getElementById('notificationContainer');
        
        // æ–°å¢ï¼šç¡®è®¤å¯¹è¯æ¡†å…ƒç´ 
        const resetConfirmationDialog = document.getElementById('resetConfirmationDialog');
        const finishConfirmationDialog = document.getElementById('finishConfirmationDialog');
        const confirmResetBtn = document.getElementById('confirmResetBtn');
        const cancelResetBtn = document.getElementById('cancelResetBtn');
        const confirmFinishBtn = document.getElementById('confirmFinishBtn');
        const cancelFinishBtn = document.getElementById('cancelFinishBtn');
        
        // æ–°å¢ï¼šé˜¶æ®µå®Œæˆç¡®è®¤å¯¹è¯æ¡†å…ƒç´ 
        const phaseCompletionDialog = document.getElementById('phaseCompletionDialog');
        const phaseCompletionTitle = document.getElementById('phaseCompletionTitle');
        const phaseCompletionMessage = document.getElementById('phaseCompletionMessage');
        const completePhaseBtn = document.getElementById('completePhaseBtn');
        const addTimePhaseBtn = document.getElementById('addTimePhaseBtn');
        
        // æ–°å¢ï¼šå†å²è®°å½•å…ƒç´ 
        const historyTableBody = document.getElementById('historyTableBody');
        const emptyHistoryMessage = document.getElementById('emptyHistoryMessage');

        // åˆå§‹åŒ–å˜é‡
        let currentPhase = 0;
        let totalSeconds = 0;
        let phaseSeconds = phases[0].duration;
        let isRunning = false;
        let isPaused = false;
        let timerInterval; // é˜¶æ®µè®¡æ—¶å™¨
        let totalTimerInterval; // æ€»è®¡æ—¶å™¨ï¼ˆç‹¬ç«‹ï¼‰
        let currentTimeInterval;
        let startTimestamp = null;
        let endTimestamp = null;
        let ttsVoiceSettings = {
            voice: null,
            pitch: 1,
            rate: 1
        };
        
        // æ–°å¢ï¼šéŸ³é¢‘ä¸Šä¸‹æ–‡å’ŒéŸ³é¢‘ç¼“å­˜
        let audioContext;
        let tickSoundBuffer;
        let warningSoundBuffer;
        let celebrationSoundBuffer;
        let minuteSoundBuffer;
        let audioInitialized = false;
        
        // æ–°å¢ï¼šé˜¶æ®µåŠ æ—¶è®°å½• - ä¿®å¤ï¼šåˆå§‹åŒ–æ‰€æœ‰é˜¶æ®µä¸º0
        let phaseExtraTime = Array(phases.length).fill(0);
        let phaseStartTimes = Array(phases.length).fill(null);
        let phaseActualDurations = Array(phases.length).fill(0);
        let phasePauseTimes = Array(phases.length).fill(0); // è®°å½•æ¯ä¸ªé˜¶æ®µçš„æš‚åœæ—¶é—´ï¼ˆç§’ï¼‰
        let pauseStartTime = null; // è®°å½•æš‚åœå¼€å§‹çš„æ—¶é—´
        let phaseElapsedSeconds = Array(phases.length).fill(0); // è®°å½•æ¯ä¸ªé˜¶æ®µå·²ç»ç»è¿‡çš„ç§’æ•°
        
        // æ–°å¢ï¼šé˜¶æ®µå®é™…ç”¨æ—¶è®°å½•å˜é‡
        let phaseActualTimeRecords = Array(phases.length).fill(0); // è®°å½•æ¯ä¸ªé˜¶æ®µçš„å®é™…ç”¨æ—¶
        let phaseElapsedTime = Array(phases.length).fill(0); // è®°å½•æ¯ä¸ªé˜¶æ®µå·²ç»ç»è¿‡çš„æ—¶é—´
        
        // æ–°å¢ï¼šåŠ æ—¶å‡æ—¶ç´¯è®¡è®°å½• - ä¿®å¤ï¼šåˆ†åˆ«è®°å½•åŠ æ—¶å’Œå‡æ—¶
        let phaseAddTimeRecords = Array(phases.length).fill(0); // è®°å½•æ¯ä¸ªé˜¶æ®µçš„åŠ æ—¶ç´¯è®¡
        let phaseSubtractTimeRecords = Array(phases.length).fill(0); // è®°å½•æ¯ä¸ªé˜¶æ®µçš„å‡æ—¶ç´¯è®¡

        // æ–°å¢ï¼šå†å²è®°å½•å­˜å‚¨
        let trainingHistory = JSON.parse(localStorage.getItem('trainingHistory')) || [];

        // åˆå§‹åŒ–é˜¶æ®µè½®ç›˜æ˜¾ç¤º
        function initializePhaseCarousel() {
            phaseCarouselTrack.innerHTML = '';
            phases.forEach((phase, index) => {
                const phaseItem = document.createElement('div');
                phaseItem.className = 'phase-carousel-item';
                phaseItem.id = `phase-carousel-${index}`;
                
                const phaseName = document.createElement('div');
                phaseName.className = 'phase-name';
                phaseName.textContent = phase.name;
                
                const phaseDescription = document.createElement('div');
                phaseDescription.className = 'phase-description';
                phaseDescription.textContent = phase.description;
                
                phaseItem.appendChild(phaseName);
                phaseItem.appendChild(phaseDescription);
                
                phaseCarouselTrack.appendChild(phaseItem);
            });
            
            // è®¾ç½®å½“å‰é˜¶æ®µä¸ºæ¿€æ´»çŠ¶æ€
            updateCarouselActivePhase();
            updateNextPhaseIndicator();
        }

        // æ›´æ–°è½®ç›˜å½“å‰æ¿€æ´»é˜¶æ®µ
        function updateCarouselActivePhase() {
            // ç§»é™¤æ‰€æœ‰æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.phase-carousel-item').forEach(item => {
                item.classList.remove('active', 'prev', 'next');
            });
            
            // è®¾ç½®å½“å‰é˜¶æ®µä¸ºæ¿€æ´»çŠ¶æ€
            const currentPhaseItem = document.getElementById(`phase-carousel-${currentPhase}`);
            if (currentPhaseItem) {
                currentPhaseItem.classList.add('active');
            }
            
            // è®¾ç½®å‰ä¸€ä¸ªå’Œåä¸€ä¸ªé˜¶æ®µ
            // è®¾ç½®å‰ä¸€ä¸ªé˜¶æ®µ
            const prevPhase = currentPhase > 0 ? currentPhase - 1 : phases.length - 1;
            const prevPhaseItem = document.getElementById(`phase-carousel-${prevPhase}`);
            if (prevPhaseItem) {
                prevPhaseItem.classList.add('prev');
            }
            
            // è®¾ç½®åä¸€ä¸ªé˜¶æ®µ
            const nextPhase = currentPhase < phases.length - 1 ? currentPhase + 1 : 0;
            const nextPhaseItem = document.getElementById(`phase-carousel-${nextPhase}`);
            if (nextPhaseItem) {
                nextPhaseItem.classList.add('next');
            }
            
            // æ›´æ–°è½®ç›˜ä½ç½®
            updateCarouselPosition();
            
            // æ›´æ–°è¿›åº¦æŒ‡ç¤ºå™¨
            updateProgressIndicator();
            
            // æ›´æ–°ä¸‹ä¸€é˜¶æ®µæŒ‡ç¤ºå™¨
            updateNextPhaseIndicator();
            
            // æ›´æ–°å¯¼èˆªæŒ‰é’®æ˜¾ç¤ºçŠ¶æ€
            updateNavigationButtons();
        }

        // æ›´æ–°å¯¼èˆªæŒ‰é’®æ˜¾ç¤ºçŠ¶æ€
        function updateNavigationButtons() {
            // æ ¹æ®å±å¹•å®½åº¦å†³å®šæ˜¾ç¤ºå“ªç§å¯¼èˆªæŒ‰é’®
            const isMobile = window.innerWidth <= 768;
            if (isMobile) {
                carouselPrev.style.display = 'flex';
                carouselNext.style.display = 'flex';
                carouselPrevVertical.style.display = 'none';
                carouselNextVertical.style.display = 'none';
            } else {
                carouselPrev.style.display = 'none';
                carouselNext.style.display = 'none';
                carouselPrevVertical.style.display = 'flex';
                carouselNextVertical.style.display = 'flex';
            }
        }

        // æ›´æ–°ä¸‹ä¸€é˜¶æ®µæŒ‡ç¤ºå™¨
        function updateNextPhaseIndicator() {
            const nextPhaseIndex = currentPhase < phases.length - 1 ? currentPhase + 1 : 0;
            nextPhaseIndicatorElement.textContent = `â†’${phases[nextPhaseIndex].name}`;
        }

        // æ›´æ–°è¿›åº¦æŒ‡ç¤ºå™¨
        function updateProgressIndicator() {
            progressIndicatorElement.textContent = `${currentPhase + 1}/${phases.length}`;
        }

        // æ›´æ–°è½®ç›˜ä½ç½®
        function updateCarouselPosition() {
            const track = document.getElementById('phaseCarouselTrack');
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                // ç§»åŠ¨ç«¯ï¼šæ°´å¹³æ»šåŠ¨
                track.style.transform = `translateX(-${currentPhase * 100}%)`;
            } else {
                // æ¡Œé¢ç«¯ï¼šå‚ç›´æ»šåŠ¨
                track.style.transform = `translateY(-${currentPhase * 100}%)`;
            }
        }

        // æ›´æ–°å½“å‰æ—¶é—´æ˜¾ç¤º
        function updateCurrentTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            currentTimeElement.textContent = `å½“å‰æ—¶é—´: ${hours}:${minutes}:${seconds}`;
        }

        // æ›´æ–°è®¡æ—¶å™¨çŠ¶æ€æ˜¾ç¤º
        function updateTimerStatus() {
            if (!isRunning && !isPaused) {
                timerStatusElement.textContent = "æœªå¼€å§‹";
                timerStatusElement.style.color = "#FFC107";
                timerStatusElement.style.backgroundColor = "rgba(255, 193, 7, 0.2)";
                timerStatusElement.classList.add('pulsing');
            } else if (isPaused) {
                timerStatusElement.textContent = "å·²æš‚åœ";
                timerStatusElement.style.color = "#FF9800";
                timerStatusElement.style.backgroundColor = "rgba(255, 152, 0, 0.2)";
                timerStatusElement.classList.add('pulsing');
            } else {
                timerStatusElement.textContent = "è¿›è¡Œä¸­";
                timerStatusElement.style.color = "#4CAF50";
                timerStatusElement.style.backgroundColor = "rgba(76, 175, 80, 0.2)";
                timerStatusElement.classList.remove('pulsing');
            }
            
            // æ›´æ–°åŠ æ—¶æŒ‰é’®çŠ¶æ€
            updateAddTimeButtonState();
            
            // æ›´æ–°å‡æ—¶æŒ‰é’®çŠ¶æ€
            updateSubtractTimeButtonState();
            
            // æ›´æ–°ç»“æŸæŒ‰é’®çŠ¶æ€
            updateFinishButtonState();
        }

        // æ›´æ–°åŠ æ—¶æŒ‰é’®çŠ¶æ€
        function updateAddTimeButtonState() {
            // åªæœ‰åœ¨è¿è¡Œä¸­æ—¶æ‰èƒ½åŠ æ—¶
            if (isRunning) {
                addTimeBtn.disabled = false;
            } else {
                addTimeBtn.disabled = true;
            }
        }

        // æ›´æ–°å‡æ—¶æŒ‰é’®çŠ¶æ€
        function updateSubtractTimeButtonState() {
            // åªæœ‰åœ¨è¿è¡Œä¸­æ—¶æ‰èƒ½å‡æ—¶ï¼ˆå³ä½¿ä¸è¶³1åˆ†é’Ÿï¼Œä¹Ÿå…è®¸ç‚¹å‡»ï¼Œä½†ä¼šåœ¨subtractTimeä¸­æ£€æŸ¥å¹¶æç¤ºï¼‰
            if (isRunning) {
                subtractTimeBtn.disabled = false;
            } else {
                subtractTimeBtn.disabled = true;
            }
        }

        // æ›´æ–°ç»“æŸæŒ‰é’®çŠ¶æ€
        function updateFinishButtonState() {
            // åªæœ‰åœ¨è¿è¡Œä¸­æˆ–å·²æš‚åœæ—¶æ‰èƒ½ç»“æŸ
            if (isRunning || isPaused) {
                finishBtn.disabled = false;
            } else {
                finishBtn.disabled = true;
            }
        }

        // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
        function formatTime(totalSeconds) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            if (hours > 0) {
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            } else {
                return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }
        }

        // æ›´æ–°é˜¶æ®µæ˜¾ç¤º
        function updatePhaseDisplay() {
            // æ›´æ–°æ€»æ—¶é—´
            totalTimerElement.textContent = `æ€»æ—¶é—´: ${formatTime(totalSeconds)}`;
            
            // æ›´æ–°å½“å‰é˜¶æ®µè®¡æ—¶å™¨
            phaseTimerElement.textContent = formatTime(phaseSeconds);
            phaseTimerElement.style.color = "#fff";
            
            // æ›´æ–°è½®ç›˜æ¿€æ´»çŠ¶æ€
            updateCarouselActivePhase();
            
            // æ›´æ–°å‡æ—¶æŒ‰é’®çŠ¶æ€
            updateSubtractTimeButtonState();
        }

        // åˆå§‹åŒ–éŸ³é¢‘ç³»ç»Ÿ
        function initializeAudio() {
            if (audioInitialized) return;
            
            try {
                // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // åˆ›å»ºè½»å¿«çš„æ»´ç­”å£°
                const tickLength = 0.05 * audioContext.sampleRate;
                tickSoundBuffer = audioContext.createBuffer(1, tickLength, audioContext.sampleRate);
                const tickData = tickSoundBuffer.getChannelData(0);
                for (let i = 0; i < tickLength; i++) {
                    // ä½¿ç”¨æ›´é«˜çš„é¢‘ç‡å’Œæ›´çŸ­çš„æŒç»­æ—¶é—´
                    tickData[i] = Math.sin(1200 * 2 * Math.PI * i / audioContext.sampleRate) * 
                                 Math.exp(-i / (0.03 * audioContext.sampleRate));
                }
                
                // åˆ›å»ºè­¦å‘Šå£°ï¼ˆç”¨äºå€’è®¡æ—¶å’Œé˜¶æ®µåˆ‡æ¢ï¼‰
                const warningLength = 0.2 * audioContext.sampleRate;
                warningSoundBuffer = audioContext.createBuffer(1, warningLength, audioContext.sampleRate);
                const warningData = warningSoundBuffer.getChannelData(0);
                for (let i = 0; i < warningLength; i++) {
                    // ä½¿ç”¨æ›´é«˜çš„é¢‘ç‡å’Œæ›´çŸ­çš„æŒç»­æ—¶é—´
                    warningData[i] = Math.sin(1500 * 2 * Math.PI * i / audioContext.sampleRate) * 
                                    Math.exp(-i / (0.1 * audioContext.sampleRate));
                }
                
                // åˆ›å»ºæ¯åˆ†é’Ÿæç¤ºéŸ³
                const minuteLength = 0.3 * audioContext.sampleRate;
                minuteSoundBuffer = audioContext.createBuffer(1, minuteLength, audioContext.sampleRate);
                const minuteData = minuteSoundBuffer.getChannelData(0);
                for (let i = 0; i < minuteLength; i++) {
                    // ä½¿ç”¨ä¸­ç­‰é¢‘ç‡å’Œè¾ƒé•¿çš„æŒç»­æ—¶é—´
                    minuteData[i] = Math.sin(800 * 2 * Math.PI * i / audioContext.sampleRate) * 
                                   Math.exp(-i / (0.2 * audioContext.sampleRate));
                }
                
                // åˆ›å»ºåº†ç¥éŸ³æ•ˆï¼ˆæ›´æ¬¢å¿«æ„‰æ‚¦çš„éŸ³æ•ˆï¼‰
                const celebrationLength = 4.5 * audioContext.sampleRate;
                celebrationSoundBuffer = audioContext.createBuffer(1, celebrationLength, audioContext.sampleRate);
                const celebrationData = celebrationSoundBuffer.getChannelData(0);
                
                // åˆ›å»ºä¸Šå‡çš„éŸ³é˜¶æ•ˆæœ - æ›´æ„‰æ‚¦çš„éŸ³ç¬¦åºåˆ—
                const notes = [523.25, 587.33, 659.25, 698.46, 783.99, 880.00, 987.77, 1046.50, 1174.66, 1318.51]; // C5åˆ°E6
                const noteDuration = celebrationLength / notes.length / audioContext.sampleRate;
                
                for (let i = 0; i < celebrationLength; i++) {
                    const t = i / audioContext.sampleRate;
                    const noteIndex = Math.floor(t / noteDuration);
                    
                    if (noteIndex < notes.length) {
                        const freq = notes[noteIndex];
                        const noteProgress = (t - noteIndex * noteDuration) / noteDuration;
                        
                        // æ·»åŠ ä¸€äº›è°æ³¢å’ŒåŒ…ç»œ - æ›´æ„‰æ‚¦çš„æ³¢å½¢
                        celebrationData[i] = 0.4 * (
                            Math.sin(2 * Math.PI * freq * t) * 
                            (1 - Math.exp(-noteProgress/0.1)) * Math.exp(-noteProgress/0.7) +
                            0.2 * Math.sin(2 * Math.PI * freq * 2 * t) * 
                            (1 - Math.exp(-noteProgress/0.1)) * Math.exp(-noteProgress/0.7) +
                            0.1 * Math.sin(2 * Math.PI * freq * 3 * t) * 
                            (1 - Math.exp(-noteProgress/0.1)) * Math.exp(-noteProgress/0.7)
                        );
                    } else {
                        celebrationData[i] = 0;
                    }
                }
                
                audioInitialized = true;
            } catch (e) {
                console.error("éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥:", e);
            }
        }

        // æ’­æ”¾éŸ³é¢‘
        function playSound(buffer) {
            if (!audioInitialized || !audioContext) {
                initializeAudio();
                return;
            }
            
            try {
                // æ£€æŸ¥éŸ³é¢‘ä¸Šä¸‹æ–‡çŠ¶æ€ï¼Œå¦‚æœæ˜¯æŒ‚èµ·çŠ¶æ€åˆ™æ¢å¤
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                const source = audioContext.createBufferSource();
                source.buffer = buffer;
                source.connect(audioContext.destination);
                source.start();
            } catch (e) {
                console.error("æ’­æ”¾éŸ³é¢‘å¤±è´¥:", e);
            }
        }

        // æ’­æ”¾æ»´ç­”å£°
        function playTickSound() {
            if (tickSoundBuffer) {
                playSound(tickSoundBuffer);
            }
        }

        // æ’­æ”¾è­¦å‘Šå£°
        function playWarningSound() {
            if (warningSoundBuffer) {
                playSound(warningSoundBuffer);
            }
        }

        // æ’­æ”¾æ¯åˆ†é’Ÿæç¤ºéŸ³
        function playMinuteSound() {
            if (minuteSoundBuffer) {
                playSound(minuteSoundBuffer);
            }
        }

        // æ’­æ”¾åº†ç¥éŸ³æ•ˆ
        function playCelebrationSound() {
            if (celebrationSoundBuffer) {
                playSound(celebrationSoundBuffer);
            }
        }

        // æ–‡æœ¬è½¬è¯­éŸ³
        function speakText(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-CN';
                utterance.rate = ttsVoiceSettings.rate;
                utterance.pitch = ttsVoiceSettings.pitch;
                utterance.volume = 1.0;
                
                // è®¾ç½®è¯­éŸ³
                if (ttsVoiceSettings.voice) {
                    utterance.voice = ttsVoiceSettings.voice;
                }
                
                // åœæ­¢ä»»ä½•æ­£åœ¨è¿›è¡Œçš„è¯­éŸ³
                window.speechSynthesis.cancel();
                
                // æ’­æ”¾æ–°è¯­éŸ³
                window.speechSynthesis.speak(utterance);
            } else {
                console.log("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ–‡æœ¬è½¬è¯­éŸ³åŠŸèƒ½");
            }
        }

        // æ£€æŸ¥å¹¶æ’­æ”¾è¯­éŸ³æç¤º
        function checkAndPlayTts() {
            // æŸ¥æ‰¾å½“å‰é˜¶æ®µçš„è¯­éŸ³æç¤º
            const currentPhaseTts = ttsSettings.filter(tts => tts.phaseId === currentPhase);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰åŒ¹é…çš„è¯­éŸ³æç¤º
            currentPhaseTts.forEach(tts => {
                if (phaseSeconds === tts.timePoint) {
                    speakText(tts.text);
                }
            });
            
            // æ¯åˆ†é’Ÿæ’­æ”¾ç‰¹æ®Šæç¤ºéŸ³
            if (phaseSeconds % 60 === 0 && phaseSeconds > 0) {
                playMinuteSound();
            }
        }

        // åˆ‡æ¢åˆ°æŒ‡å®šé˜¶æ®µ
        function switchToPhase(phaseIndex) {
            if (phaseIndex < 0 || phaseIndex >= phases.length) return;
            
            // æ£€æŸ¥è®¡æ—¶å™¨æ˜¯å¦åœ¨è¿è¡Œä¸­
            if (isRunning) {
                showNotification("è®¡æ—¶å™¨è¿è¡Œä¸­", "è®¡æ—¶å™¨è¿è¡Œä¸­ï¼Œè¯·å…ˆé‡ç½®è®¡æ—¶å™¨ã€‚", "warning");
                return;
            }
            
            // è®°å½•å½“å‰é˜¶æ®µçš„ç»“æŸæ—¶é—´
            if (isRunning && currentPhase < phases.length) {
                // è®°å½•å½“å‰é˜¶æ®µçš„å®é™…ç”¨æ—¶
                const initialPhaseSeconds = phases[currentPhase].duration + phaseExtraTime[currentPhase];
                phaseActualDurations[currentPhase] = initialPhaseSeconds - phaseSeconds;
            }
            
            currentPhase = phaseIndex;
            phaseSeconds = phases[currentPhase].duration + phaseExtraTime[currentPhase];
            
            // è®°å½•æ–°é˜¶æ®µçš„å¼€å§‹æ—¶é—´
            if (isRunning) {
                phaseStartTimes[currentPhase] = totalSeconds;
            }
            
            updatePhaseDisplay();
        }

        // åˆ‡æ¢åˆ°ä¸Šä¸€é˜¶æ®µ
        function previousPhase() {
            if (currentPhase > 0) {
                switchToPhase(currentPhase - 1);
            } else {
                switchToPhase(phases.length - 1);
            }
        }

        // åˆ‡æ¢åˆ°ä¸‹ä¸€é˜¶æ®µ
        function nextPhase() {
            if (currentPhase < phases.length - 1) {
                switchToPhase(currentPhase + 1);
            } else {
                switchToPhase(0);
            }
        }

        // å¼€å§‹å‡†å¤‡å€’è®¡æ—¶
        function startCountdown() {
            let count = 3;
            countdownNumber.textContent = count;
            countdownOverlay.classList.add('active');
            
            // ç«‹å³æ’­æ”¾ç¬¬ä¸€æ¬¡å€’è®¡æ—¶å£°éŸ³
            playWarningSound();
            
            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownNumber.textContent = count;
                    playWarningSound(); // æ’­æ”¾è­¦å‘Šå£°ä½œä¸ºå€’è®¡æ—¶éŸ³æ•ˆ
                } else {
                    countdownNumber.textContent = "å¼€å§‹!";
                    playWarningSound(); // æ’­æ”¾"å¼€å§‹"éŸ³æ•ˆ
                    setTimeout(() => {
                        countdownOverlay.classList.remove('active');
                        clearInterval(countdownInterval);
                        
                        // è®°å½•å¼€å§‹æ—¶é—´
                        startTimestamp = new Date();
                        const timeString = startTimestamp.toLocaleTimeString();
                        startTimeElement.textContent = `å¼€å§‹æ—¶é—´: ${timeString}`;
                        startTimeMobileElement.textContent = `å¼€å§‹æ—¶é—´: ${timeString}`;
                        
                        // è®°å½•æ¯ä¸ªé˜¶æ®µçš„å¼€å§‹æ—¶é—´
                        phaseStartTimes[currentPhase] = totalSeconds;
                        
                        startTimer(); // å€’è®¡æ—¶ç»“æŸåå¼€å§‹æ­£å¼è®¡æ—¶
                    }, 1000);
                }
            }, 1000);
        }

        // é˜¶æ®µè®¡æ—¶æ›´æ–°å‡½æ•°
        function updatePhaseTimer() {
            if (!isRunning) return;
            
            // åªæœ‰åœ¨éæš‚åœçŠ¶æ€ä¸‹ï¼Œæ‰æ›´æ–°é˜¶æ®µå€’è®¡æ—¶å’Œæ£€æŸ¥è¯­éŸ³æç¤ºç­‰
            if (!isPaused) {
                phaseSeconds--;
                
                // è®°å½•å½“å‰é˜¶æ®µçš„ç»è¿‡æ—¶é—´
                phaseElapsedTime[currentPhase]++;
                
                // æ’­æ”¾æ»´ç­”å£°
                playTickSound();
                
                // æ£€æŸ¥å¹¶æ’­æ”¾è¯­éŸ³æç¤º
                checkAndPlayTts();
                
                // æ£€æŸ¥é˜¶æ®µåˆ‡æ¢
                if (phaseSeconds <= 0) {
                    // æ’­æ”¾è­¦å‘Šå£°ä½œä¸ºé˜¶æ®µç»“æŸæç¤º
                    playWarningSound();
                    
                    // æ£€æŸ¥æ˜¯å¦ä¸ºéœ€è¦ç¡®è®¤çš„é˜¶æ®µï¼ˆéä¼‘æ¯é˜¶æ®µï¼‰
                    const currentPhaseName = phases[currentPhase].name;
                    const isRestPhase = currentPhaseName.includes("ä¼‘æ¯");
                    
                    if (!isRestPhase) {
                        // éä¼‘æ¯é˜¶æ®µï¼šæš‚åœè®¡æ—¶å¹¶æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
                        pauseTimer();
                        
                        // è®¾ç½®ç¡®è®¤å¯¹è¯æ¡†å†…å®¹
                        phaseCompletionTitle.textContent = `${currentPhaseName}å®Œæˆç¡®è®¤`;
                        phaseCompletionMessage.textContent = `æ‚¨æ˜¯å¦å·²å®Œæˆ${currentPhaseName}ï¼Ÿ`;
                        
                        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
                        phaseCompletionDialog.classList.add('active');
                    } else {
                        // ä¼‘æ¯é˜¶æ®µï¼šç›´æ¥è¿›å…¥ä¸‹ä¸€é˜¶æ®µ
                        proceedToNextPhase();
                    }
                }
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦æ’­æ”¾è­¦å‘Šå£°ï¼ˆé˜¶æ®µåˆ‡æ¢å‰3ç§’ï¼‰
                if (phaseSeconds <= 3 && phaseSeconds > 0) {
                    playWarningSound();
                }
            }
            
            // æ›´æ–°æ˜¾ç¤º
            updatePhaseDisplay();
        }

        // ç»§ç»­åˆ°ä¸‹ä¸€é˜¶æ®µ
        function proceedToNextPhase() {
            // è®°å½•å½“å‰é˜¶æ®µçš„å®é™…ç”¨æ—¶
            const initialPhaseSeconds = phases[currentPhase].duration + phaseExtraTime[currentPhase];
            phaseActualDurations[currentPhase] = initialPhaseSeconds;
            phaseActualTimeRecords[currentPhase] = initialPhaseSeconds; // è®°å½•å®é™…ç”¨æ—¶
            
            // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µ
            currentPhase++;
            
            if (currentPhase >= phases.length) {
                // æ‰€æœ‰é˜¶æ®µå®Œæˆ
                currentPhase = phases.length - 1; // ä¿æŒåœ¨æœ€åä¸€ä¸ªé˜¶æ®µ
                phaseSeconds = 0;
                
                // è‡ªåŠ¨åœæ­¢è®¡æ—¶
                finishTraining();
            } else {
                // è®°å½•æ–°é˜¶æ®µçš„å¼€å§‹æ—¶é—´
                phaseStartTimes[currentPhase] = totalSeconds;
                
                // é‡ç½®é˜¶æ®µæ—¶é—´
                phaseSeconds = phases[currentPhase].duration + phaseExtraTime[currentPhase];
                
                // é‡ç½®æ–°é˜¶æ®µçš„ç»è¿‡æ—¶é—´
                phaseElapsedTime[currentPhase] = 0;
                
                // å¦‚æœè®¡æ—¶å™¨æ˜¯æš‚åœçŠ¶æ€ï¼Œåˆ™æ¢å¤è®¡æ—¶
                if (isPaused) {
                    startTimer();
                }
            }
            
            // æ›´æ–°æ˜¾ç¤º
            updatePhaseDisplay();
        }

        // æ€»è®¡æ—¶æ›´æ–°å‡½æ•°ï¼ˆç‹¬ç«‹è¿è¡Œï¼‰
        function updateTotalTimer() {
            if (isRunning || isPaused) {
                totalSeconds++;
                updatePhaseDisplay(); // æ›´æ–°æ˜¾ç¤º
            }
        }

        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            if (isRunning) return;
            
            isRunning = true;
            isPaused = false;
            
            // å¦‚æœæ˜¯ä»æš‚åœçŠ¶æ€æ¢å¤ï¼Œéœ€è¦è®°å½•æš‚åœç»“æŸæ—¶é—´
            if (pauseStartTime) {
                const pauseEndTime = new Date();
                const pauseDuration = Math.floor((pauseEndTime - pauseStartTime) / 1000);
                phasePauseTimes[currentPhase] += pauseDuration;
                pauseStartTime = null;
            }
            
            startBtn.disabled = true;
            pauseBtn.disabled = false;
            resetBtn.disabled = false;
            
            updateTimerStatus();
            
            // å¯åŠ¨é˜¶æ®µè®¡æ—¶å™¨
            timerInterval = setInterval(updatePhaseTimer, 1000);
            
            // å¯åŠ¨ç‹¬ç«‹çš„æ€»è®¡æ—¶å™¨ï¼ˆå¦‚æœè¿˜æ²¡æœ‰å¯åŠ¨ï¼‰
            if (!totalTimerInterval) {
                totalTimerInterval = setInterval(updateTotalTimer, 1000);
            }
        }

        // æš‚åœè®¡æ—¶å™¨
        function pauseTimer() {
            if (!isRunning) return;
            
            isRunning = false;
            isPaused = true;
            
            clearInterval(timerInterval); // åªåœæ­¢é˜¶æ®µè®¡æ—¶å™¨
            
            // è®°å½•æš‚åœå¼€å§‹æ—¶é—´
            pauseStartTime = new Date();
            
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            startBtn.textContent = "ç»§ç»­";
            
            updateTimerStatus();
        }

        // åœæ­¢è®¡æ—¶å™¨
        function stopTimer() {
            isRunning = false;
            isPaused = false;
            
            clearInterval(timerInterval);
            
            // å¦‚æœæš‚åœçŠ¶æ€ä¸‹åœæ­¢ï¼Œéœ€è¦è®°å½•æš‚åœç»“æŸæ—¶é—´
            if (pauseStartTime) {
                const pauseEndTime = new Date();
                const pauseDuration = Math.floor((pauseEndTime - pauseStartTime) / 1000);
                phasePauseTimes[currentPhase] += pauseDuration;
                pauseStartTime = null;
            }
            
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            resetBtn.disabled = true;
            startBtn.textContent = "å¼€å§‹";
            
            updateTimerStatus();
        }

        // é‡ç½®è®¡æ—¶å™¨
        function resetTimer() {
            stopTimer();
            
            // åœæ­¢æ€»è®¡æ—¶å™¨
            if (totalTimerInterval) {
                clearInterval(totalTimerInterval);
                totalTimerInterval = null;
            }
            
            currentPhase = 0;
            totalSeconds = 0;
            phaseSeconds = phases[0].duration;
            startTimestamp = null;
            endTimestamp = null;
            startTimeElement.textContent = "å¼€å§‹æ—¶é—´: --:--:--";
            endTimeElement.textContent = "ç»“æŸæ—¶é—´: --:--:--";
            startTimeMobileElement.textContent = "å¼€å§‹æ—¶é—´: --:--:--";
            endTimeMobileElement.textContent = "ç»“æŸæ—¶é—´: --:--:--";
            
            // é‡ç½®åŠ æ—¶è®°å½• - ä¿®å¤ï¼šåŒæ—¶é‡ç½®åŠ æ—¶å‡æ—¶è®°å½•
            phaseExtraTime = Array(phases.length).fill(0);
            phaseStartTimes = Array(phases.length).fill(null);
            phaseActualDurations = Array(phases.length).fill(0);
            phasePauseTimes = Array(phases.length).fill(0);
            phaseElapsedSeconds = Array(phases.length).fill(0);
            phaseActualTimeRecords = Array(phases.length).fill(0);
            phaseElapsedTime = Array(phases.length).fill(0);
            phaseAddTimeRecords = Array(phases.length).fill(0); // é‡ç½®åŠ æ—¶è®°å½•
            phaseSubtractTimeRecords = Array(phases.length).fill(0); // é‡ç½®å‡æ—¶è®°å½•
            pauseStartTime = null;
            
            updatePhaseDisplay();
        }

        // åŠ æ—¶åŠŸèƒ½ - ä¿®å¤ï¼šæ­£ç¡®è®°å½•åŠ æ—¶æ—¶é—´
        function addTime() {
            // if (!isRunning) return;
            
            // ä¸ºå½“å‰é˜¶æ®µå¢åŠ 1åˆ†é’Ÿ
            phaseExtraTime[currentPhase] += 60;
            phaseSeconds += 60;
            
            // è®°å½•åŠ æ—¶ç´¯è®¡
            phaseAddTimeRecords[currentPhase] += 60;
            
            // æ˜¾ç¤ºåŠ æ—¶æç¤º
            showTimeAdjustmentMessage("+1åˆ†é’Ÿ", "add");
            
            // æ›´æ–°æ˜¾ç¤º
            updatePhaseDisplay();
        }

        // å‡æ—¶åŠŸèƒ½ - ä¿®å¤ï¼šæ­£ç¡®è®°å½•å‡æ—¶æ—¶é—´
        function subtractTime() {
            if (!isRunning) return;
            
            // æ£€æŸ¥é˜¶æ®µå‰©ä½™æ—¶é—´æ˜¯å¦å¤§äº1åˆ†é’Ÿ
            if (phaseSeconds <= 60) {
                showNotification("å‡æ—¶å¤±è´¥", "é˜¶æ®µå‰©ä½™æ—¶é—´ä¸è¶³1åˆ†é’Ÿï¼Œæ— æ³•å‡æ—¶", "warning");
                return;
            }
            
            // ä¸ºå½“å‰é˜¶æ®µå‡å°‘1åˆ†é’Ÿ
            phaseExtraTime[currentPhase] -= 60;
            phaseSeconds -= 60;
            
            // è®°å½•å‡æ—¶ç´¯è®¡
            phaseSubtractTimeRecords[currentPhase] += 60;
            
            // æ˜¾ç¤ºå‡æ—¶æç¤º
            showTimeAdjustmentMessage("-1åˆ†é’Ÿ", "subtract");
            
            // æ›´æ–°æ˜¾ç¤º
            updatePhaseDisplay();
        }

        // æ˜¾ç¤ºæ—¶é—´è°ƒæ•´æç¤º
        function showTimeAdjustmentMessage(message, type) {
            timeAdjustmentMessage.textContent = message;
            
            // è®¾ç½®æ ·å¼
            if (type === "add") {
                timeAdjustmentMessage.classList.remove("subtract");
            } else {
                timeAdjustmentMessage.classList.add("subtract");
            }
            
            timeAdjustmentMessage.classList.add('show');
            
            setTimeout(() => {
                timeAdjustmentMessage.classList.remove('show');
            }, 2000);
        }

        // åˆ›å»ºçƒŸèŠ±æ•ˆæœ
        function createFireworks() {
            fireworksContainer.innerHTML = '';
            
            // åˆ›å»ºå¤šä¸ªçƒŸèŠ±ç²’å­
            for (let i = 0; i < 150; i++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                
                // éšæœºè®¾ç½®ç²’å­çš„ä½ç½®å’Œé¢œè‰²
                const angle = Math.random() * Math.PI * 2;
                const distance = 100 + Math.random() * 400;
                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;
                
                firework.style.setProperty('--x', `${x}px`);
                firework.style.setProperty('--y', `${y}px`);
                
                // éšæœºé¢œè‰²
                const colors = ['#fdbb2d', '#ff5e62', '#ff9966', '#ff5e9e', '#c56cf0'];
                firework.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                // éšæœºå»¶è¿Ÿ
                firework.style.animationDelay = `${Math.random() * 0.5}s`;
                
                fireworksContainer.appendChild(firework);
            }
            
            // æ˜¾ç¤ºçƒŸèŠ±æ•ˆæœå’Œæ–‡å­—
            fireworksOverlay.classList.add('active');
            
            // æ’­æ”¾åº†ç¥éŸ³æ•ˆ
            playCelebrationSound();
            
            // æ’­æ”¾è¯­éŸ³æç¤º
            speakText("æ­å–œå®Œæˆè®­ç»ƒï¼å¤ªæ£’å•¦ï¼");
            
            // 3ç§’åæ˜¾ç¤ºæŠ¥å‘Š
            setTimeout(() => {
                fireworksOverlay.classList.remove('active');
                generateReport();
            }, 3000);
        }

        // ç»“æŸè®­ç»ƒå¹¶ç”ŸæˆæŠ¥å‘Š
        function finishTraining() {
            if (!isRunning && !isPaused) return;
            
            // åœæ­¢è®¡æ—¶å™¨
            stopTimer();
            
            // è®°å½•ç»“æŸæ—¶é—´
            endTimestamp = new Date();
            const timeString = endTimestamp.toLocaleTimeString();
            endTimeElement.textContent = `ç»“æŸæ—¶é—´: ${timeString}`;
            endTimeMobileElement.textContent = `ç»“æŸæ—¶é—´: ${timeString}`;
            
            // è®°å½•å½“å‰é˜¶æ®µçš„å®é™…ç”¨æ—¶
            if (currentPhase < phases.length) {
                const initialPhaseSeconds = phases[currentPhase].duration + phaseExtraTime[currentPhase];
                phaseActualDurations[currentPhase] = initialPhaseSeconds - phaseSeconds;
                phaseActualTimeRecords[currentPhase] = initialPhaseSeconds - phaseSeconds; // è®°å½•å®é™…ç”¨æ—¶
            }
            
            // æ˜¾ç¤ºçƒŸèŠ±åº†ç¥æ•ˆæœ
            createFireworks();
            
            // ä¿å­˜è®­ç»ƒè®°å½•åˆ°å†å²
            saveTrainingRecord();
        }

        // ä¿å­˜è®­ç»ƒè®°å½•åˆ°å†å²
        function saveTrainingRecord() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const date = `${year}-${month}-${day}`;
            
            // è®¡ç®—è¿åŠ¨è®¡åˆ’æ—¶é—´ï¼ˆæ‰€æœ‰é˜¶æ®µæ—¶é—´ä¹‹å’Œï¼‰
            let plannedTime = 0;
            for (let i = 0; i < phases.length; i++) {
                plannedTime += phases[i].duration;
            }
            
            // å®é™…è¿åŠ¨æ—¶é—´ä½¿ç”¨æ€»è®¡æ—¶è®°å½•çš„æ—¶é—´
            let actualTime = totalSeconds;
            
            // è®¡ç®—æ€»è®¡åŠ æ—¶æ—¶é—´
            let totalExtraTime = phaseAddTimeRecords.reduce((sum, time) => sum + time, 0);
            
            // è®¡ç®—æ€»è®¡å‡æ—¶æ—¶é—´
            let totalSubtractTime = phaseSubtractTimeRecords.reduce((sum, time) => sum + time, 0);
            
            // è®¡ç®—æ€»è®¡æš‚åœæ—¶é—´
            let totalPauseTime = phasePauseTimes.reduce((sum, time) => sum + time, 0);
            
            // è®¡ç®—å®Œæˆç¨‹åº¦
            const totalTimeDiff = actualTime - plannedTime;
            const totalTimeDiffMinutes = Math.abs(totalTimeDiff) / 60;
            
            let totalPerformanceText;
            
            if (actualTime < 60) {
                totalPerformanceText = "æœªè®­ç»ƒ";
            } else if (totalTimeDiff >= 0) {
                // å®é™…ç”¨æ—¶å¤§äºè®¡åˆ’ç”¨æ—¶
                if (totalTimeDiffMinutes <= 1) {
                    totalPerformanceText = "ä¼˜ç§€";
                } else if (totalTimeDiffMinutes <= 3) {
                    totalPerformanceText = "å‹‰å¼º";
                } else if (totalTimeDiffMinutes <= 8) {
                    totalPerformanceText = "åƒåŠ›";
                } else {
                    totalPerformanceText = "è¶…å¼ºåº¦";
                }
            } else {
                // å®é™…ç”¨æ—¶å°äºè®¡åˆ’ç”¨æ—¶
                if (totalTimeDiffMinutes <= 1) {
                    totalPerformanceText = "ä¼˜ç§€";
                } else if (totalTimeDiffMinutes <= 3) {
                    totalPerformanceText = "ä¸€èˆ¬";
                } else {
                    totalPerformanceText = "ç¼©å‡ç‰ˆ";
                }
            }
            
            // åˆ›å»ºè®­ç»ƒè®°å½•
            const trainingRecord = {
                id: Date.now(), // ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºå”¯ä¸€ID
                date: date,
                startTime: startTimestamp ? startTimestamp.toLocaleTimeString() : '--:--:--',
                endTime: endTimestamp ? endTimestamp.toLocaleTimeString() : '--:--:--',
                plannedTime: formatTime(plannedTime),
                actualTime: formatTime(actualTime),
                totalExtraTime: formatTime(totalExtraTime),
                totalSubtractTime: formatTime(totalSubtractTime),
                totalPauseTime: formatTime(totalPauseTime),
                totalPerformance: totalPerformanceText,
                phases: phases.map((phase, index) => ({
                    name: phase.name,
                    plannedTime: formatTime(phase.duration),
                    actualTime: formatTime(phaseActualTimeRecords[index] || phaseElapsedTime[index]),
                    extraTime: formatTime(phaseAddTimeRecords[index]),
                    subtractTime: formatTime(phaseSubtractTimeRecords[index]),
                    pauseTime: formatTime(phasePauseTimes[index]),
                    performance: calculatePerformance(phase, index)
                }))
            };
            
            // æ·»åŠ åˆ°å†å²è®°å½•
            trainingHistory.unshift(trainingRecord);
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('trainingHistory', JSON.stringify(trainingHistory));
        }

        // è®¡ç®—é˜¶æ®µå®Œæˆç¨‹åº¦
        function calculatePerformance(phase, index) {
            const actualDuration = phaseActualTimeRecords[index] || phaseElapsedTime[index];
            const plannedDuration = phase.duration;
            const timeDiff = actualDuration - plannedDuration;
            const timeDiffMinutes = Math.abs(timeDiff) / 60;
            
            if (actualDuration < 60) {
                return "æœªè®­ç»ƒ";
            } else if (timeDiff >= 0) {
                // å®é™…ç”¨æ—¶å¤§äºè®¡åˆ’ç”¨æ—¶
                if (timeDiffMinutes <= 1) {
                    return "ä¼˜ç§€";
                } else if (timeDiffMinutes <= 3) {
                    return "å‹‰å¼º";
                } else if (timeDiffMinutes <= 8) {
                    return "åƒåŠ›";
                } else {
                    return "è¶…å¼ºåº¦";
                }
            } else {
                // å®é™…ç”¨æ—¶å°äºè®¡åˆ’ç”¨æ—¶
                if (timeDiffMinutes <= 1) {
                    return "ä¼˜ç§€";
                } else if (timeDiffMinutes <= 3) {
                    return "ä¸€èˆ¬";
                } else {
                    return "ç¼©å‡ç‰ˆ";
                }
            }
        }

        // å°†æ—¶é—´å­—ç¬¦ä¸²è½¬æ¢ä¸ºç§’æ•°
        function parseTimeString(timeStr) {
            if (timeStr === "-") return 0;
            
            const parts = timeStr.split(':');
            if (parts.length === 3) {
                // æ ¼å¼: hh:mm:ss
                return parseInt(parts[0]) * 3600 + parseInt(parts[1]) * 60 + parseInt(parts[2]);
            } else if (parts.length === 2) {
                // æ ¼å¼: mm:ss
                return parseInt(parts[0]) * 60 + parseInt(parts[1]);
            }
            return 0;
        }

        // ç”ŸæˆæŠ¥å‘Š - ä¿®å¤ï¼šä½¿ç”¨æ­£ç¡®çš„åŠ æ—¶å‡æ—¶è®°å½•
        function generateReport() {
            // è®¡ç®—è¿åŠ¨è®¡åˆ’æ—¶é—´ï¼ˆæ‰€æœ‰é˜¶æ®µæ—¶é—´ä¹‹å’Œï¼‰
            let plannedTime = 0;
            for (let i = 0; i < phases.length; i++) {
                plannedTime += phases[i].duration;
            }
            
            // å®é™…è¿åŠ¨æ—¶é—´ä½¿ç”¨æ€»è®¡æ—¶è®°å½•çš„æ—¶é—´
            let actualTime = totalSeconds;
            
            // æ›´æ–°æŠ¥å‘Šæ ‡é¢˜ï¼Œæ·»åŠ æ—¥æœŸ
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            reportTitle.textContent = `${year}å¹´${month}æœˆ${day}æ—¥ è¿åŠ¨æ‰§è¡Œæƒ…å†µæŠ¥å‘Š`;
            
            // æ›´æ–°æŠ¥å‘Šæ‘˜è¦
            document.getElementById('reportStartTime').textContent = startTimestamp ? startTimestamp.toLocaleTimeString() : '--:--:--';
            document.getElementById('reportEndTime').textContent = endTimestamp ? endTimestamp.toLocaleTimeString() : '--:--:--';
            document.getElementById('reportPlannedTime').textContent = formatTime(plannedTime);
            document.getElementById('reportActualTime').textContent = formatTime(actualTime);
            
            // æ›´æ–°æŠ¥å‘Šè¡¨æ ¼
            const reportTableBody = document.getElementById('reportTableBody');
            reportTableBody.innerHTML = '';
            
            // åˆå§‹åŒ–æ€»è®¡å˜é‡
            let totalPlannedTime = 0;
            let totalActualTime = 0;
            let totalExtraTime = 0;
            let totalSubtractTime = 0;
            let totalPauseTime = 0;
            
            // å…ˆæ·»åŠ æ€»è®¡è¡Œ
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row'; // æ·»åŠ æ€»è®¡è¡Œæ ·å¼ç±»
            
            const totalNameCell = document.createElement('td');
            totalNameCell.textContent = 'æ€»è®¡';
            
            const totalPlannedCell = document.createElement('td');
            totalPlannedCell.textContent = formatTime(totalPlannedTime);
            
            const totalActualCell = document.createElement('td');
            totalActualCell.textContent = formatTime(totalActualTime);
            totalActualCell.classList.add('actual-time-purple');
            
            const totalExtraCell = document.createElement('td');
            totalExtraCell.textContent = totalExtraTime > 0 ? formatTime(totalExtraTime) : '-';
            if (totalExtraTime > 0) {
                totalExtraCell.classList.add('extra-time-red');
            }
            
            const totalSubtractCell = document.createElement('td');
            totalSubtractCell.textContent = totalSubtractTime > 0 ? '-' + formatTime(totalSubtractTime) : '-';
            if (totalSubtractTime > 0) {
                totalSubtractCell.classList.add('subtract-time-green');
            }
            
            const totalPauseCell = document.createElement('td');
            totalPauseCell.textContent = totalPauseTime > 0 ? formatTime(totalPauseTime) : '-';
            
            const totalPerformanceCell = document.createElement('td');
            totalPerformanceCell.textContent = '-';
            
            totalRow.appendChild(totalNameCell);
            totalRow.appendChild(totalPlannedCell);
            totalRow.appendChild(totalActualCell);
            totalRow.appendChild(totalExtraCell);
            totalRow.appendChild(totalSubtractCell);
            totalRow.appendChild(totalPauseCell);
            totalRow.appendChild(totalPerformanceCell);
            
            reportTableBody.appendChild(totalRow);
            
            // æ·»åŠ å„é˜¶æ®µè¡Œ
            for (let i = 0; i < phases.length; i++) {
                const phase = phases[i];
                const row = document.createElement('tr');
                
                // é˜¶æ®µåç§°
                const nameCell = document.createElement('td');
                nameCell.textContent = phase.name;
                
                // è®¡åˆ’ç”¨æ—¶
                const plannedCell = document.createElement('td');
                plannedCell.textContent = formatTime(phase.duration);
                totalPlannedTime += phase.duration;
                
                // å®é™…ç”¨æ—¶ - ä½¿ç”¨é˜¶æ®µå®é™…ç”¨æ—¶è®°å½•
                const actualCell = document.createElement('td');
                // ä¼˜å…ˆä½¿ç”¨ phaseActualTimeRecordsï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ phaseElapsedTime
                const actualDuration = phaseActualTimeRecords[i] > 0 ? phaseActualTimeRecords[i] : phaseElapsedTime[i];
                actualCell.textContent = formatTime(actualDuration);
                actualCell.classList.add('actual-time-purple');
                totalActualTime += actualDuration;
                
                // åŠ æ—¶æ—¶é—´ - ä¿®å¤ï¼šä½¿ç”¨ phaseAddTimeRecords è€Œä¸æ˜¯ phaseExtraTime
                const extraCell = document.createElement('td');
                if (phaseAddTimeRecords[i] > 0) {
                    extraCell.textContent = formatTime(phaseAddTimeRecords[i]);
                    extraCell.classList.add('extra-time-red');
                    totalExtraTime += phaseAddTimeRecords[i];
                } else {
                    extraCell.textContent = "-";
                }
                
                // å‡æ—¶æ—¶é—´ - ä¿®å¤ï¼šä½¿ç”¨ phaseSubtractTimeRecords è€Œä¸æ˜¯ phaseExtraTime
                const subtractCell = document.createElement('td');
                if (phaseSubtractTimeRecords[i] > 0) {
                    subtractCell.textContent = '-' + formatTime(phaseSubtractTimeRecords[i]);
                    subtractCell.classList.add('subtract-time-green');
                    totalSubtractTime += phaseSubtractTimeRecords[i];
                } else {
                    subtractCell.textContent = "-";
                }
                
                // æš‚åœæ—¶é—´
                const pauseCell = document.createElement('td');
                if (phasePauseTimes[i] > 0) {
                    pauseCell.textContent = formatTime(phasePauseTimes[i]);
                    totalPauseTime += phasePauseTimes[i];
                } else {
                    pauseCell.textContent = "-";
                }
                
                // å®Œæˆç¨‹åº¦
                const performanceCell = document.createElement('td');
                const actualDurationValue = actualDuration || 0;
                const plannedDuration = phase.duration;
                const timeDiff = actualDurationValue - plannedDuration;
                const timeDiffMinutes = Math.abs(timeDiff) / 60;
                
                let performanceText, performanceClass;
                
                if (actualDurationValue < 60) {
                    performanceText = "æœªè®­ç»ƒ";
                    performanceClass = "performance-untrained";
                } else if (timeDiff >= 0) {
                    // å®é™…ç”¨æ—¶å¤§äºè®¡åˆ’ç”¨æ—¶
                    if (timeDiffMinutes <= 1) {
                        performanceText = "ä¼˜ç§€";
                        performanceClass = "performance-excellent";
                    } else if (timeDiffMinutes <= 3) {
                        performanceText = "å‹‰å¼º";
                        performanceClass = "performance-fair";
                    } else if (timeDiffMinutes <= 8) {
                        performanceText = "åƒåŠ›";
                        performanceClass = "performance-hard";
                    } else {
                        performanceText = "è¶…å¼ºåº¦";
                        performanceClass = "performance-extreme";
                    }
                } else {
                    // å®é™…ç”¨æ—¶å°äºè®¡åˆ’ç”¨æ—¶
                    if (timeDiffMinutes <= 1) {
                        performanceText = "ä¼˜ç§€";
                        performanceClass = "performance-excellent";
                    } else if (timeDiffMinutes <= 3) {
                        performanceText = "ä¸€èˆ¬";
                        performanceClass = "performance-general";
                    } else {
                        performanceText = "ç¼©å‡ç‰ˆ";
                        performanceClass = "performance-reduced";
                    }
                }
                
                performanceCell.textContent = performanceText;
                performanceCell.className = performanceClass;
                
                row.appendChild(nameCell);
                row.appendChild(plannedCell);
                row.appendChild(actualCell);
                row.appendChild(extraCell);
                row.appendChild(subtractCell);
                row.appendChild(pauseCell);
                row.appendChild(performanceCell);
                
                reportTableBody.appendChild(row);
            }
            
            // æ›´æ–°æ€»è®¡è¡Œçš„æ•°æ®
            totalPlannedCell.textContent = formatTime(totalPlannedTime);
            totalActualCell.textContent = formatTime(totalActualTime);
            totalExtraCell.textContent = totalExtraTime > 0 ? formatTime(totalExtraTime) : '-';
            totalSubtractCell.textContent = totalSubtractTime > 0 ? '-' + formatTime(totalSubtractTime) : '-';
            totalPauseCell.textContent = totalPauseTime > 0 ? formatTime(totalPauseTime) : '-';
            
            // è®¡ç®—æ€»è®¡è¡Œçš„å®Œæˆç¨‹åº¦
            const totalTimeDiff = totalActualTime - totalPlannedTime;
            const totalTimeDiffMinutes = Math.abs(totalTimeDiff) / 60;
            
            let totalPerformanceText, totalPerformanceClass;
            
            if (totalActualTime < 60) {
                totalPerformanceText = "æœªè®­ç»ƒ";
                totalPerformanceClass = "performance-untrained";
            } else if (totalTimeDiff >= 0) {
                // å®é™…ç”¨æ—¶å¤§äºè®¡åˆ’ç”¨æ—¶
                if (totalTimeDiffMinutes <= 1) {
                    totalPerformanceText = "ä¼˜ç§€";
                    totalPerformanceClass = "performance-excellent";
                } else if (totalTimeDiffMinutes <= 3) {
                    totalPerformanceText = "å‹‰å¼º";
                    totalPerformanceClass = "performance-fair";
                } else if (totalTimeDiffMinutes <= 8) {
                    totalPerformanceText = "åƒåŠ›";
                    totalPerformanceClass = "performance-hard";
                } else {
                    totalPerformanceText = "è¶…å¼ºåº¦";
                    totalPerformanceClass = "performance-extreme";
                }
            } else {
                // å®é™…ç”¨æ—¶å°äºè®¡åˆ’ç”¨æ—¶
                if (totalTimeDiffMinutes <= 1) {
                    totalPerformanceText = "ä¼˜ç§€";
                    totalPerformanceClass = "performance-excellent";
                } else if (totalTimeDiffMinutes <= 3) {
                    totalPerformanceText = "ä¸€èˆ¬";
                    totalPerformanceClass = "performance-general";
                } else {
                    totalPerformanceText = "ç¼©å‡ç‰ˆ";
                    totalPerformanceClass = "performance-reduced";
                }
            }
            
            totalPerformanceCell.textContent = totalPerformanceText;
            totalPerformanceCell.className = totalPerformanceClass;
            
            // æ˜¾ç¤ºæŠ¥å‘Šæ¨¡æ€æ¡†
            reportModal.style.display = 'flex';
        }

        // ç”Ÿæˆæ—¥å¿—æ–‡æœ¬
        function generateLogText() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const date = `${year}å¹´${month}æœˆ${day}æ—¥`;
            
            // è®¡ç®—è¿åŠ¨è®¡åˆ’æ—¶é—´ï¼ˆæ‰€æœ‰é˜¶æ®µæ—¶é—´ä¹‹å’Œï¼‰
            let plannedTime = 0;
            for (let i = 0; i < phases.length; i++) {
                plannedTime += phases[i].duration;
            }
            
            // å®é™…è¿åŠ¨æ—¶é—´ä½¿ç”¨æ€»è®¡æ—¶è®°å½•çš„æ—¶é—´
            let actualTime = totalSeconds;
            
            // è®¡ç®—æ€»è®¡åŠ æ—¶æ—¶é—´
            let totalExtraTime = phaseAddTimeRecords.reduce((sum, time) => sum + time, 0);
            
            // è®¡ç®—æ€»è®¡å‡æ—¶æ—¶é—´
            let totalSubtractTime = phaseSubtractTimeRecords.reduce((sum, time) => sum + time, 0);
            
            // è®¡ç®—æ€»è®¡æš‚åœæ—¶é—´
            let totalPauseTime = phasePauseTimes.reduce((sum, time) => sum + time, 0);
            
            // è®¡ç®—å®Œæˆç¨‹åº¦
            const totalTimeDiff = actualTime - plannedTime;
            const totalTimeDiffMinutes = Math.abs(totalTimeDiff) / 60;
            
            let totalPerformanceText;
            
            if (actualTime < 60) {
                totalPerformanceText = "æœªè®­ç»ƒ";
            } else if (totalTimeDiff >= 0) {
                // å®é™…ç”¨æ—¶å¤§äºè®¡åˆ’ç”¨æ—¶
                if (totalTimeDiffMinutes <= 1) {
                    totalPerformanceText = "ä¼˜ç§€";
                } else if (totalTimeDiffMinutes <= 3) {
                    totalPerformanceText = "å‹‰å¼º";
                } else if (totalTimeDiffMinutes <= 8) {
                    totalPerformanceText = "åƒåŠ›";
                } else {
                    totalPerformanceText = "è¶…å¼ºåº¦";
                }
            } else {
                // å®é™…ç”¨æ—¶å°äºè®¡åˆ’ç”¨æ—¶
                if (totalTimeDiffMinutes <= 1) {
                    totalPerformanceText = "ä¼˜ç§€";
                } else if (totalTimeDiffMinutes <= 3) {
                    totalPerformanceText = "ä¸€èˆ¬";
                } else {
                    totalPerformanceText = "ç¼©å‡ç‰ˆ";
                }
            }
            
            let logText = `# è¿åŠ¨æ—¥å¿— - ${date}\n`;
            logText += `å¼€å§‹æ—¶é—´: ${startTimestamp ? startTimestamp.toLocaleTimeString() : '--:--:--'}\n`;
            logText += `ç»“æŸæ—¶é—´: ${endTimestamp ? endTimestamp.toLocaleTimeString() : '--:--:--'}\n`;
            logText += `æ€»è®¡åˆ’æ—¶é—´: ${formatTime(plannedTime)}\n`;
            logText += `å®é™…è¿åŠ¨æ—¶é—´: ${formatTime(actualTime)}\n\n`;
            logText += `ã€æ€»è®¡ï¼šè®¡åˆ’ç”¨æ—¶ ${formatTime(plannedTime)}, å®é™…ç”¨æ—¶ ${formatTime(actualTime)}, åŠ æ—¶æ—¶é—´ ${formatTime(totalExtraTime)}, å‡æ—¶æ—¶é—´ ${formatTime(totalSubtractTime)}, æš‚åœæ—¶é—´ ${formatTime(totalPauseTime)}, å®Œæˆç¨‹åº¦ ${totalPerformanceText}ã€‘\n\n`;
            logText += `å„é˜¶æ®µè¯¦æƒ…:\n`;
            
            for (let i = 0; i < phases.length; i++) {
                const phase = phases[i];
                const actualDuration = phaseActualTimeRecords[i] > 0 ? phaseActualTimeRecords[i] : phaseElapsedTime[i];
                const extraTime = phaseAddTimeRecords[i];
                const subtractTime = phaseSubtractTimeRecords[i];
                const pauseTime = phasePauseTimes[i];
                const performance = calculatePerformance(phase, i);
                
                logText += `${phase.name}ï¼šè®¡åˆ’ç”¨æ—¶ ${formatTime(phase.duration)}, å®é™…ç”¨æ—¶ ${formatTime(actualDuration)}, åŠ æ—¶æ—¶é—´ ${formatTime(extraTime)}, å‡æ—¶æ—¶é—´ ${formatTime(subtractTime)}, æš‚åœæ—¶é—´ ${formatTime(pauseTime)}, å®Œæˆç¨‹åº¦ ${performance}\n`;
            }
            
            return logText;
        }

        // å¤åˆ¶æ—¥å¿—åˆ°å‰ªè´´æ¿
        function copyLogToClipboard() {
            const logText = generateLogText();
            
            navigator.clipboard.writeText(logText).then(() => {
                showNotification("å¤åˆ¶æˆåŠŸ", "è¿åŠ¨æ—¥å¿—å·²å¤åˆ¶åˆ°å‰ªè´´æ¿", "info");
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥: ', err);
                showNotification("å¤åˆ¶å¤±è´¥", "æ— æ³•å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶", "warning");
            });
        }

        // æ˜¾ç¤ºå†å²è®°å½•
        function showHistory() {
            // æ£€æŸ¥è®¡æ—¶å™¨æ˜¯å¦åœ¨è¿è¡Œä¸­
            if (isRunning || isPaused) {
                showNotification("è®¡æ—¶å™¨è¿è¡Œä¸­", "è®¡æ—¶å™¨è¿è¡Œä¸­ï¼Œè¯·ç»“æŸæˆ–é‡ç½®è®¡æ—¶å™¨åæŸ¥çœ‹ã€‚", "warning");
                return;
            }

            historyTableBody.innerHTML = '';
            
            if (trainingHistory.length === 0) {
                emptyHistoryMessage.style.display = 'block';
            } else {
                emptyHistoryMessage.style.display = 'none';
                
                trainingHistory.forEach(record => {
                    const row = document.createElement('tr');
                    
                    // æ—¥æœŸ
                    const dateCell = document.createElement('td');
                    dateCell.textContent = record.date;
                    
                    // å¼€å§‹æ—¶é—´
                    const startTimeCell = document.createElement('td');
                    startTimeCell.textContent = record.startTime;
                    
                    // ç»“æŸæ—¶é—´
                    const endTimeCell = document.createElement('td');
                    endTimeCell.textContent = record.endTime;
                    
                    // å®é™…ç”¨æ—¶
                    const actualTimeCell = document.createElement('td');
                    actualTimeCell.textContent = record.actualTime;
                    
                    // æ“ä½œ
                    const actionsCell = document.createElement('td');
                    actionsCell.className = 'history-actions';
                    
                    const viewBtn = document.createElement('button');
                    viewBtn.textContent = 'æŸ¥çœ‹';
                    viewBtn.className = 'history-btn';
                    viewBtn.addEventListener('click', () => {
                        viewTrainingRecord(record);
                    });
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'åˆ é™¤';
                    deleteBtn.className = 'delete-phase-btn';
                    deleteBtn.addEventListener('click', () => {
                        deleteTrainingRecord(record.id);
                    });
                    
                    actionsCell.appendChild(viewBtn);
                    actionsCell.appendChild(deleteBtn);
                    
                    row.appendChild(dateCell);
                    row.appendChild(startTimeCell);
                    row.appendChild(endTimeCell);
                    row.appendChild(actualTimeCell);
                    row.appendChild(actionsCell);
                    
                    historyTableBody.appendChild(row);
                });
            }
            
            historyModal.style.display = 'flex';
        }

        // æŸ¥çœ‹è®­ç»ƒè®°å½•
        function viewTrainingRecord(record) {
            // æ›´æ–°æŠ¥å‘Šæ ‡é¢˜
            reportTitle.textContent = `${record.date} è¿åŠ¨æ‰§è¡Œæƒ…å†µæŠ¥å‘Š`;
            
            // æ›´æ–°æŠ¥å‘Šæ‘˜è¦
            document.getElementById('reportStartTime').textContent = record.startTime;
            document.getElementById('reportEndTime').textContent = record.endTime;
            document.getElementById('reportPlannedTime').textContent = record.plannedTime;
            document.getElementById('reportActualTime').textContent = record.actualTime;
            
            // æ›´æ–°æŠ¥å‘Šè¡¨æ ¼
            const reportTableBody = document.getElementById('reportTableBody');
            reportTableBody.innerHTML = '';
            
            // æ·»åŠ æ€»è®¡è¡Œ
            const totalRow = document.createElement('tr');
            totalRow.className = 'total-row';
            
            const totalNameCell = document.createElement('td');
            totalNameCell.textContent = 'æ€»è®¡';
            
            const totalPlannedCell = document.createElement('td');
            totalPlannedCell.textContent = record.plannedTime;
            
            const totalActualCell = document.createElement('td');
            totalActualCell.textContent = record.actualTime;
            totalActualCell.classList.add('actual-time-purple');
            
            const totalExtraCell = document.createElement('td');
            totalExtraCell.textContent = record.totalExtraTime !== "00:00" ? record.totalExtraTime : '-';
            if (record.totalExtraTime !== "00:00") {
                totalExtraCell.classList.add('extra-time-red');
            }
            
            const totalSubtractCell = document.createElement('td');
            totalSubtractCell.textContent = record.totalSubtractTime !== "00:00" ? '-' + record.totalSubtractTime : '-';
            if (record.totalSubtractTime !== "00:00") {
                totalSubtractCell.classList.add('subtract-time-green');
            }
            
            const totalPauseCell = document.createElement('td');
            totalPauseCell.textContent = record.totalPauseTime !== "00:00" ? record.totalPauseTime : '-';
            
            const totalPerformanceCell = document.createElement('td');
            totalPerformanceCell.textContent = record.totalPerformance;
            
            totalRow.appendChild(totalNameCell);
            totalRow.appendChild(totalPlannedCell);
            totalRow.appendChild(totalActualCell);
            totalRow.appendChild(totalExtraCell);
            totalRow.appendChild(totalSubtractCell);
            totalRow.appendChild(totalPauseCell);
            totalRow.appendChild(totalPerformanceCell);
            
            reportTableBody.appendChild(totalRow);
            
            // æ·»åŠ å„é˜¶æ®µè¡Œ
            record.phases.forEach(phase => {
                const row = document.createElement('tr');
                
                // é˜¶æ®µåç§°
                const nameCell = document.createElement('td');
                nameCell.textContent = phase.name;
                
                // è®¡åˆ’ç”¨æ—¶
                const plannedCell = document.createElement('td');
                plannedCell.textContent = phase.plannedTime;
                
                // å®é™…ç”¨æ—¶
                const actualCell = document.createElement('td');
                actualCell.textContent = phase.actualTime;
                actualCell.classList.add('actual-time-purple');
                
                // åŠ æ—¶æ—¶é—´
                const extraCell = document.createElement('td');
                extraCell.textContent = phase.extraTime !== "00:00" ? phase.extraTime : '-';
                if (phase.extraTime !== "00:00") {
                    extraCell.classList.add('extra-time-red');
                }
                
                // å‡æ—¶æ—¶é—´
                const subtractCell = document.createElement('td');
                subtractCell.textContent = phase.subtractTime !== "00:00" ? '-' + phase.subtractTime : '-';
                if (phase.subtractTime !== "00:00") {
                    subtractCell.classList.add('subtract-time-green');
                }
                
                // æš‚åœæ—¶é—´
                const pauseCell = document.createElement('td');
                pauseCell.textContent = phase.pauseTime !== "00:00" ? phase.pauseTime : '-';
                
                // å®Œæˆç¨‹åº¦
                const performanceCell = document.createElement('td');
                performanceCell.textContent = phase.performance;
                
                row.appendChild(nameCell);
                row.appendChild(plannedCell);
                row.appendChild(actualCell);
                row.appendChild(extraCell);
                row.appendChild(subtractCell);
                row.appendChild(pauseCell);
                row.appendChild(performanceCell);
                
                reportTableBody.appendChild(row);
            });
            
            // éšè—å†å²è®°å½•æ¨¡æ€æ¡†ï¼Œæ˜¾ç¤ºæŠ¥å‘Šæ¨¡æ€æ¡†
            historyModal.style.display = 'none';
            reportModal.style.display = 'flex';
        }

        // åˆ é™¤è®­ç»ƒè®°å½•
        function deleteTrainingRecord(id) {
            trainingHistory = trainingHistory.filter(record => record.id !== id);
            localStorage.setItem('trainingHistory', JSON.stringify(trainingHistory));
            showHistory(); // åˆ·æ–°å†å²è®°å½•æ˜¾ç¤º
            showNotification("åˆ é™¤æˆåŠŸ", "è®­ç»ƒè®°å½•å·²åˆ é™¤", "info");
        }

        // æ¸…ç©ºå†å²è®°å½•
        function clearHistory() {
            if (trainingHistory.length === 0) {
                showNotification("æ¸…ç©ºè®°å½•", "æ²¡æœ‰å¯æ¸…ç©ºçš„è®°å½•", "info");
                return;
            }
            
            if (confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")) {
                trainingHistory = [];
                localStorage.setItem('trainingHistory', JSON.stringify(trainingHistory));
                showHistory(); // åˆ·æ–°å†å²è®°å½•æ˜¾ç¤º
                showNotification("æ¸…ç©ºæˆåŠŸ", "æ‰€æœ‰å†å²è®°å½•å·²æ¸…ç©º", "info");
            }
        }

        // è‡ªå®šä¹‰é€šçŸ¥å‡½æ•°
        function showNotification(title, message, type = "info") {
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            const titleElement = document.createElement('div');
            titleElement.className = 'notification-title';
            titleElement.textContent = title;
            
            const messageElement = document.createElement('div');
            messageElement.className = 'notification-message';
            messageElement.textContent = message;
            
            notification.appendChild(titleElement);
            notification.appendChild(messageElement);
            
            notificationContainer.appendChild(notification);
            
            // æ˜¾ç¤ºé€šçŸ¥
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                notification.classList.remove('show');
                notification.classList.add('hide');
                
                // å®Œå…¨ç§»é™¤é€šçŸ¥
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // æ‰“å¼€ç¼–è¾‘é˜¶æ®µæ¨¡æ€æ¡†
        function openEditPhasesModal() {
            if (isRunning) {
                showNotification("ç¼–è¾‘é˜¶æ®µ", "è®¡æ—¶å™¨è¿è¡Œæ—¶ä¸èƒ½ç¼–è¾‘å„é˜¶æ®µï¼Œè¯·å…ˆé‡ç½®è®¡æ—¶å™¨ã€‚", "warning");
                return;
            }
            
            phasesEditContainer.innerHTML = '';
            
            phases.forEach((phase, index) => {
                const phaseEditDiv = document.createElement('div');
                phaseEditDiv.className = 'phase-edit-item';
                
                const phaseHeader = document.createElement('div');
                phaseHeader.className = 'phase-edit-header';
                
                const phaseTitle = document.createElement('div');
                phaseTitle.className = 'phase-edit-title';
                
                // æ·»åŠ é˜¶æ®µåç§°
                const phaseNameSpan = document.createElement('span');
                phaseNameSpan.textContent = `${index + 1}. ${phase.name}`;
                phaseTitle.appendChild(phaseNameSpan);
                
                // æ·»åŠ é˜¶æ®µæ—¶é—´æ˜¾ç¤º
                const phaseDurationSpan = document.createElement('span');
                phaseDurationSpan.className = 'phase-duration-display';
                phaseDurationSpan.textContent = `${Math.floor(phase.duration / 60)} åˆ†é’Ÿ`;
                phaseTitle.appendChild(phaseDurationSpan);
                
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'toggle-btn';
                toggleBtn.textContent = 'â–¼';
                toggleBtn.dataset.index = index;
                
                phaseHeader.appendChild(phaseTitle);
                phaseHeader.appendChild(toggleBtn);
                
                const phaseContent = document.createElement('div');
                phaseContent.className = 'phase-edit-content';
                phaseContent.id = `phase-content-${index}`;
                
                const nameLabel = document.createElement('label');
                nameLabel.textContent = 'é˜¶æ®µåç§°:';
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.value = phase.name;
                nameInput.dataset.index = index;
                nameInput.dataset.field = 'name';
                
                const descLabel = document.createElement('label');
                descLabel.textContent = 'é˜¶æ®µæè¿°:';
                const descInput = document.createElement('input');
                descInput.type = 'text';
                descInput.value = phase.description;
                descInput.dataset.index = index;
                descInput.dataset.field = 'description';
                
                const durationLabel = document.createElement('label');
                durationLabel.textContent = 'æŒç»­æ—¶é—´ (åˆ†é’Ÿ):';
                const durationInput = document.createElement('input');
                durationInput.type = 'number';
                durationInput.min = '1';
                durationInput.max = '120';
                durationInput.value = Math.floor(phase.duration / 60);
                durationInput.dataset.index = index;
                durationInput.dataset.field = 'duration';
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-phase-btn';
                deleteBtn.textContent = 'åˆ é™¤é˜¶æ®µ';
                deleteBtn.addEventListener('click', () => {
                    if (phases.length > 1) { // è‡³å°‘ä¿ç•™ä¸€ä¸ªé˜¶æ®µ
                        phases.splice(index, 1);
                        openEditPhasesModal(); // é‡æ–°æ¸²æŸ“
                    } else {
                        showNotification("åˆ é™¤é˜¶æ®µ", "è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªè®­ç»ƒé˜¶æ®µ", "warning");
                    }
                });
                
                phaseContent.appendChild(nameLabel);
                phaseContent.appendChild(nameInput);
                phaseContent.appendChild(descLabel);
                phaseContent.appendChild(descInput);
                phaseContent.appendChild(durationLabel);
                phaseContent.appendChild(durationInput);
                phaseContent.appendChild(deleteBtn);
                
                phaseEditDiv.appendChild(phaseHeader);
                phaseEditDiv.appendChild(phaseContent);
                phasesEditContainer.appendChild(phaseEditDiv);
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                toggleBtn.addEventListener('click', () => {
                    const content = document.getElementById(`phase-content-${index}`);
                    if (content.classList.contains('show')) {
                        content.classList.remove('show');
                        toggleBtn.textContent = 'â–¼';
                    } else {
                        content.classList.add('show');
                        toggleBtn.textContent = 'â–²';
                    }
                });
                
                // æ·»åŠ æŒç»­æ—¶é—´è¾“å…¥å˜åŒ–äº‹ä»¶ï¼Œæ›´æ–°é˜¶æ®µæ ‡é¢˜ä¸­çš„æ—¶é—´æ˜¾ç¤º
                durationInput.addEventListener('input', () => {
                    const minutes = durationInput.value;
                    const durationSpan = phaseTitle.querySelector('.phase-duration-display');
                    if (durationSpan) {
                        durationSpan.textContent = `${minutes} åˆ†é’Ÿ`;
                    }
                });
            });
            
            editPhasesModal.style.display = 'flex';
        }

        // ä¿å­˜é˜¶æ®µç¼–è¾‘
        function savePhasesEdit() {
            let hasError = false;
            let hasChanges = false;
            
            // åˆ›å»ºé˜¶æ®µæ•°æ®çš„æ·±æ‹·è´ç”¨äºæ¯”è¾ƒ
            const originalPhases = JSON.parse(JSON.stringify(phases));
            
            const inputs = phasesEditContainer.querySelectorAll('input');

            // å…ˆéªŒè¯æ‰€æœ‰è¾“å…¥
            inputs.forEach(input => {
                const field = input.dataset.field;
                const index = parseInt(input.dataset.index);

                if (field === 'duration') {
                    const minutes = parseInt(input.value);

                    if (isNaN(minutes) || minutes < 1 || minutes > 120) {
                        hasError = true;
                        input.style.border = "2px solid #F44336";
                    } else {
                        input.style.border = "";
                    }
                }
            });
            
            // å¦‚æœæœ‰é”™è¯¯ï¼Œæç¤ºç”¨æˆ·
            if (hasError) {
                showNotification("è¾“å…¥é”™è¯¯", "è¯·è¾“å…¥1-120ä¹‹é—´çš„æœ‰æ•ˆåˆ†é’Ÿæ•°", "warning");
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
            inputs.forEach(input => {
                const index = parseInt(input.dataset.index);
                const field = input.dataset.field;
                const value = input.value;
                
                if (field === 'duration') {
                    const minutes = parseInt(value);
                    const originalMinutes = Math.floor(originalPhases[index].duration / 60);
                    if (minutes !== originalMinutes) {
                        hasChanges = true;
                    }
                } else {
                    if (value !== originalPhases[index][field]) {
                        hasChanges = true;
                    }
                }
            });
            
            // å¦‚æœæ²¡æœ‰æ›´æ”¹ï¼Œåˆ™ç›´æ¥å…³é—­æ¨¡æ€æ¡†å¹¶æç¤º
            if (!hasChanges) {
                editPhasesModal.style.display = 'none';
                showNotification("æ— æ›´æ”¹", "é˜¶æ®µè®¾ç½®æ²¡æœ‰æ›´æ”¹", "info");
                return;
            }
            
            // ä¿å­˜æ•°æ®
            inputs.forEach(input => {
                const index = parseInt(input.dataset.index);
                const field = input.dataset.field;
                
                if (field === 'duration') {
                    const minutes = parseInt(input.value);
                    phases[index][field] = minutes * 60;
                } else {
                    phases[index][field] = input.value;
                }
            });
            
            // æ›´æ–°å½“å‰é˜¶æ®µçš„å‰©ä½™æ—¶é—´ï¼Œä½†ä¸é‡ç½®å…¶ä»–çŠ¶æ€
            phaseSeconds = phases[currentPhase].duration + phaseExtraTime[currentPhase];
            
            // æ›´æ–°æ˜¾ç¤º
            initializePhaseCarousel();
            updatePhaseDisplay();

            editPhasesModal.style.display = 'none';
            showNotification("ä¿å­˜æˆåŠŸ", "é˜¶æ®µè®¾ç½®å·²æˆåŠŸæ›´æ–°ï¼Œè¯·æ³¨æ„ç›¸å…³çš„è¯­éŸ³æç¤º", "info");
        }

        // æ·»åŠ æ–°é˜¶æ®µ
        function addNewPhase() {
            phases.push({
                name: "æ–°é˜¶æ®µ",
                duration: 5 * 60,
                description: "é˜¶æ®µæè¿°"
            });
            openEditPhasesModal(); // é‡æ–°æ¸²æŸ“
        }

        // åˆå§‹åŒ–è¯­éŸ³è®¾ç½®
        function initializeTtsSettings() {
            // è·å–å¯ç”¨çš„è¯­éŸ³
            function loadVoices() {
                if ('speechSynthesis' in window) {
                    const voices = speechSynthesis.getVoices();
                    
                    // æ¸…ç©ºç°æœ‰é€‰é¡¹
                    ttsVoice.innerHTML = '<option value="">é»˜è®¤éŸ³è‰²</option>';
                    
                    // æ·»åŠ è¯­éŸ³é€‰é¡¹
                    voices.forEach(voice => {
                        const option = document.createElement('option');
                        option.value = voice.name;
                        option.textContent = `${voice.name} (${voice.lang})`;
                        ttsVoice.appendChild(option);
                    });
                    
                    // è®¾ç½®è¯­éŸ³é€‰æ‹©äº‹ä»¶
                    ttsVoice.addEventListener('change', () => {
                        const voices = speechSynthesis.getVoices();
                        const selectedVoice = voices.find(voice => voice.name === ttsVoice.value);
                        ttsVoiceSettings.voice = selectedVoice || null;
                    });
                }
            }
            
            // è¯­éŸ³åˆ—è¡¨å¯èƒ½éœ€è¦æ—¶é—´åŠ è½½
            if (speechSynthesis.getVoices().length === 0) {
                speechSynthesis.addEventListener('voiceschanged', loadVoices);
            } else {
                loadVoices();
            }
            
            // è®¾ç½®éŸ³è°ƒæ»‘å—äº‹ä»¶
            ttsPitch.addEventListener('input', () => {
                ttsPitchValue.textContent = ttsPitch.value;
                ttsVoiceSettings.pitch = parseFloat(ttsPitch.value);
            });
            
            // è®¾ç½®è¯­é€Ÿæ»‘å—äº‹ä»¶
            ttsRate.addEventListener('input', () => {
                ttsRateValue.textContent = ttsRate.value;
                ttsVoiceSettings.rate = parseFloat(ttsRate.value);
            });
            
            // è®¾ç½®æµ‹è¯•æŒ‰é’®äº‹ä»¶
            ttsTestBtn.addEventListener('click', () => {
                speakText("è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•è¯­éŸ³ï¼Œç”¨äºæµ‹è¯•å½“å‰éŸ³è‰²ã€éŸ³è°ƒå’Œè¯­é€Ÿè®¾ç½®");
            });
            
            // è®¾ç½®è¯­éŸ³è®¾ç½®åˆ‡æ¢æŒ‰é’®äº‹ä»¶
            toggleVoiceSettingsBtn.addEventListener('click', () => {
                if (ttsVoiceControls.classList.contains('show')) {
                    ttsVoiceControls.classList.remove('show');
                    toggleVoiceSettingsBtn.textContent = 'æ˜¾ç¤ºè¯­éŸ³è®¾ç½®';
                } else {
                    ttsVoiceControls.classList.add('show');
                    toggleVoiceSettingsBtn.textContent = 'éšè—è¯­éŸ³è®¾ç½®';
                }
            });
        }

        // æ‰“å¼€è¯­éŸ³è®¾ç½®æ¨¡æ€æ¡†
        function openTtsSettingsModal() {
            // æ£€æŸ¥è®¡æ—¶å™¨æ˜¯å¦åœ¨è¿è¡Œä¸­
            if (isRunning) {
                showNotification("è®¡æ—¶å™¨è¿è¡Œä¸­", "è®¡æ—¶å™¨è¿è¡Œä¸­ï¼Œè¯·å…ˆæš‚åœæˆ–é‡ç½®è®¡æ—¶å™¨ã€‚", "warning");
                return;
            }
            
            ttsEditContainer.innerHTML = '';
            
            ttsSettings.forEach((tts, index) => {
                const ttsEditDiv = document.createElement('div');
                ttsEditDiv.className = 'tts-edit-item';
                
                const ttsHeader = document.createElement('div');
                ttsHeader.className = 'tts-edit-header';
                
                const ttsTitle = document.createElement('div');
                ttsTitle.className = 'tts-edit-title';
                
                // ä¿®æ”¹ï¼šæ·»åŠ é˜¶æ®µåç§°å’Œåºå·ï¼Œå»æ‰æ–‡å­—æ˜¾ç¤º
                const phaseName = phases[tts.phaseId] ? phases[tts.phaseId].name : 'æœªçŸ¥é˜¶æ®µ';
                const ttsNameSpan = document.createElement('span');
                ttsNameSpan.textContent = `${index + 1}. ${phaseName}-é˜¶æ®µ${tts.phaseId + 1}`;
                ttsTitle.appendChild(ttsNameSpan);
                
                // æ·»åŠ æ—¶é—´ç‚¹æ˜¾ç¤º
                const ttsTimepointSpan = document.createElement('span');
                ttsTimepointSpan.className = 'tts-timepoint-display';
                ttsTimepointSpan.textContent = `${tts.timePoint} ç§’`;
                ttsTitle.appendChild(ttsTimepointSpan);
                
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'toggle-btn';
                toggleBtn.textContent = 'â–¼';
                toggleBtn.dataset.index = index;
                
                ttsHeader.appendChild(ttsTitle);
                ttsHeader.appendChild(toggleBtn);
                
                const ttsContent = document.createElement('div');
                ttsContent.className = 'tts-edit-content';
                ttsContent.id = `tts-content-${index}`;
                
                const phaseLabel = document.createElement('label');
                phaseLabel.textContent = 'é˜¶æ®µ:';
                const phaseSelect = document.createElement('select');
                phases.forEach((phase, phaseIndex) => {
                    const option = document.createElement('option');
                    option.value = phaseIndex;
                    option.textContent = phase.name;
                    if (phaseIndex === tts.phaseId) {
                        option.selected = true;
                    }
                    phaseSelect.appendChild(option);
                });
                phaseSelect.dataset.index = index;
                phaseSelect.dataset.field = 'phaseId';
                
                const timeLabel = document.createElement('label');
                timeLabel.textContent = 'æ—¶é—´ç‚¹ (ç§’):';
                const timeInput = document.createElement('input');
                timeInput.type = 'number';
                timeInput.min = '1';
                timeInput.max = '3600';
                timeInput.value = tts.timePoint;
                timeInput.dataset.index = index;
                timeInput.dataset.field = 'timePoint';
                
                const textLabel = document.createElement('label');
                textLabel.textContent = 'è¯­éŸ³å†…å®¹:';
                const textInput = document.createElement('input');
                textInput.type = 'text';
                textInput.value = tts.text;
                textInput.dataset.index = index;
                textInput.dataset.field = 'text';
                
                // ä¿®æ”¹ï¼šåŠ¨æ€è°ƒæ•´è¾“å…¥æ¡†å¤§å°ä»¥æ˜¾ç¤ºå®Œæ•´å†…å®¹
                textInput.style.width = '100%';
                textInput.style.minWidth = '100%';
                textInput.addEventListener('input', function() {
                    this.style.width = '100%';
                    this.style.width = (this.scrollWidth) + 'px';
                });
                // åˆå§‹è®¾ç½®
                setTimeout(() => {
                    textInput.style.width = (textInput.scrollWidth) + 'px';
                }, 0);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-tts-btn';
                deleteBtn.textContent = 'åˆ é™¤è¯­éŸ³æç¤º';
                deleteBtn.addEventListener('click', () => {
                    ttsSettings.splice(index, 1);
                    openTtsSettingsModal(); // é‡æ–°æ¸²æŸ“
                });
                
                ttsContent.appendChild(phaseLabel);
                ttsContent.appendChild(phaseSelect);
                ttsContent.appendChild(timeLabel);
                ttsContent.appendChild(timeInput);
                ttsContent.appendChild(textLabel);
                ttsContent.appendChild(textInput);
                ttsContent.appendChild(deleteBtn);
                
                ttsEditDiv.appendChild(ttsHeader);
                ttsEditDiv.appendChild(ttsContent);
                ttsEditContainer.appendChild(ttsEditDiv);
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                toggleBtn.addEventListener('click', () => {
                    const content = document.getElementById(`tts-content-${index}`);
                    if (content.classList.contains('show')) {
                        content.classList.remove('show');
                        toggleBtn.textContent = 'â–¼';
                    } else {
                        content.classList.add('show');
                        toggleBtn.textContent = 'â–²';
                    }
                });
                
                // æ·»åŠ æ—¶é—´ç‚¹è¾“å…¥å˜åŒ–äº‹ä»¶ï¼Œæ›´æ–°æ ‡é¢˜ä¸­çš„æ—¶é—´æ˜¾ç¤º
                timeInput.addEventListener('input', () => {
                    const seconds = timeInput.value;
                    const timepointSpan = ttsTitle.querySelector('.tts-timepoint-display');
                    if (timepointSpan) {
                        timepointSpan.textContent = `${seconds} ç§’`;
                    }
                });
                
                // æ·»åŠ é˜¶æ®µé€‰æ‹©å˜åŒ–äº‹ä»¶ï¼Œæ›´æ–°æ ‡é¢˜ä¸­çš„é˜¶æ®µåç§°
                phaseSelect.addEventListener('change', () => {
                    const selectedPhaseId = parseInt(phaseSelect.value);
                    const phaseName = phases[selectedPhaseId] ? phases[selectedPhaseId].name : 'æœªçŸ¥é˜¶æ®µ';
                    const nameSpan = ttsTitle.querySelector('span:first-child');
                    if (nameSpan) {
                        nameSpan.textContent = `${index + 1}. ${phaseName}-é˜¶æ®µ${selectedPhaseId + 1}`;
                    }
                });
            });
            
            ttsSettingsModal.style.display = 'flex';
        }

        // ä¿å­˜è¯­éŸ³è®¾ç½®
        function saveTtsSettings() {
            const inputs = ttsEditContainer.querySelectorAll('select, input');
            const newTtsSettings = [];
            
            inputs.forEach(input => {
                const index = parseInt(input.dataset.index);
                const field = input.dataset.field;
                
                if (!newTtsSettings[index]) {
                    newTtsSettings[index] = { phaseId: 0, timePoint: 0, text: '' };
                }
                
                if (field === 'phaseId' || field === 'timePoint') {
                    newTtsSettings[index][field] = parseInt(input.value);
                } else {
                    newTtsSettings[index][field] = input.value;
                }
            });
            
            ttsSettings = newTtsSettings;
            ttsSettingsModal.style.display = 'none';
            showNotification("ä¿å­˜æˆåŠŸ", "è¯­éŸ³è®¾ç½®å·²æˆåŠŸæ›´æ–°", "info");
        }

        // æ·»åŠ æ–°çš„è¯­éŸ³æç¤º
        function addNewTts() {
            ttsSettings.push({
                phaseId: 0,
                timePoint: 30,
                text: "æ–°çš„è¯­éŸ³æç¤º"
            });
            openTtsSettingsModal(); // é‡æ–°æ¸²æŸ“
        }

        // åˆå§‹åŒ–
        function initialize() {
            initializePhaseCarousel();
            updateCurrentTime();
            updatePhaseDisplay();
            updateTimerStatus();
            
            // åˆå§‹åŒ–éŸ³é¢‘ç³»ç»Ÿ
            initializeAudio();
            
            // åˆå§‹åŒ–è¯­éŸ³è®¾ç½®
            initializeTtsSettings();
            
            // æ¯ç§’æ›´æ–°å½“å‰æ—¶é—´
            currentTimeInterval = setInterval(updateCurrentTime, 1000);
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            startBtn.addEventListener('click', () => {
                // ç‚¹å‡»å¼€å§‹æŒ‰é’®æ—¶åˆå§‹åŒ–éŸ³é¢‘å¹¶å¼€å§‹å€’è®¡æ—¶
                initializeAudio();
                startCountdown();
            });
            
            pauseBtn.addEventListener('click', pauseTimer);
            
            resetBtn.addEventListener('click', () => {
                // æ˜¾ç¤ºé‡ç½®ç¡®è®¤å¯¹è¯æ¡†
                resetConfirmationDialog.classList.add('active');
            });
            
            finishBtn.addEventListener('click', () => {
                // æ˜¾ç¤ºç»“æŸç¡®è®¤å¯¹è¯æ¡†
                finishConfirmationDialog.classList.add('active');
            });
            
            addTimeBtn.addEventListener('click', addTime);
            subtractTimeBtn.addEventListener('click', subtractTime);
            
            // ç¡®è®¤å¯¹è¯æ¡†æŒ‰é’®äº‹ä»¶
            confirmResetBtn.addEventListener('click', () => {
                resetConfirmationDialog.classList.remove('active');
                resetTimer();
            });
            
            cancelResetBtn.addEventListener('click', () => {
                resetConfirmationDialog.classList.remove('active');
            });
            
            confirmFinishBtn.addEventListener('click', () => {
                finishConfirmationDialog.classList.remove('active');
                finishTraining();
            });
            
            cancelFinishBtn.addEventListener('click', () => {
                finishConfirmationDialog.classList.remove('active');
            });
            
            // é˜¶æ®µå®Œæˆç¡®è®¤å¯¹è¯æ¡†æŒ‰é’®äº‹ä»¶
            completePhaseBtn.addEventListener('click', () => {
                phaseCompletionDialog.classList.remove('active');
                proceedToNextPhase();
            });

            addTimePhaseBtn.addEventListener('click', () => {
                phaseCompletionDialog.classList.remove('active');
                addTime();
                startTimer();
            });
            
            // ä¸ºæŒ‰é’®æ·»åŠ ç‚¹å‡»åé¦ˆæ•ˆæœ
            const controlButtons = document.querySelectorAll('#subtractTimeBtn, #addTimeBtn, #startBtn, #pauseBtn, #resetBtn, #finishBtn');
            controlButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    // åˆ›å»ºæ¶Ÿæ¼ªæ•ˆæœ
                    const ripple = document.createElement('span');
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;
                    
                    ripple.style.cssText = `
                        position: absolute;
                        border-radius: 50%;
                        background: rgba(255, 255, 255, 0.6);
                        transform: scale(0);
                        animation: ripple 600ms linear;
                        width: ${size}px;
                        height: ${size}px;
                        top: ${y}px;
                        left: ${x}px;
                    `;
                    
                    this.appendChild(ripple);
                    
                    setTimeout(() => {
                        ripple.remove();
                    }, 600);
                });
            });
            
            // ä¸ºé˜¶æ®µåˆ‡æ¢æŒ‰é’®æ·»åŠ ç‚¹å‡»æ•ˆæœ
            const carouselButtons = document.querySelectorAll('.carousel-nav, .carousel-nav-vertical');
            carouselButtons.forEach(button => {
                button.addEventListener('click', function() {
                    
                    this.style.transform = 'scale(0.9)';
                    if (this.classList.contains('carousel-nav-vertical')) {
                        this.style.transform = 'translateX(-50%) scale(0.9)';
                    }
                    
                    setTimeout(() => {
                        this.style.transform = '';
                        if (this.classList.contains('carousel-nav-vertical')) {
                            this.style.transform = 'translateX(-50%)';
                        }
                    }, 150);
                });
            });
            
            // è½®ç›˜å¯¼èˆªäº‹ä»¶
            carouselPrev.addEventListener('click', previousPhase);
            carouselNext.addEventListener('click', nextPhase);
            carouselPrevVertical.addEventListener('click', previousPhase);
            carouselNextVertical.addEventListener('click', nextPhase);
            
            // è®¾ç½®æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
            editPhasesBtn.addEventListener('click', openEditPhasesModal);
            ttsSettingsBtn.addEventListener('click', openTtsSettingsModal);
            historyBtn.addEventListener('click', showHistory);
            
            // é˜¶æ®µç¼–è¾‘æ¨¡æ€æ¡†äº‹ä»¶ç›‘å¬å™¨
            addPhaseBtn.addEventListener('click', addNewPhase);
            savePhasesBtn.addEventListener('click', savePhasesEdit);
            cancelPhasesEditBtn.addEventListener('click', () => {
                editPhasesModal.style.display = 'none';
            });
            
            // è¯­éŸ³è®¾ç½®æ¨¡æ€æ¡†äº‹ä»¶ç›‘å¬å™¨
            addTtsBtn.addEventListener('click', addNewTts);
            saveTtsBtn.addEventListener('click', saveTtsSettings);
            cancelTtsBtn.addEventListener('click', () => {
                ttsSettingsModal.style.display = 'none';
            });
            
            // æŠ¥å‘Šæ¨¡æ€æ¡†äº‹ä»¶ç›‘å¬å™¨
            copyLogBtn.addEventListener('click', copyLogToClipboard);
            closeReportBtn.addEventListener('click', () => {
                reportModal.style.display = 'none';
                resetTimer(); // å…³é—­æŠ¥å‘Šæ—¶é‡ç½®è®¡æ—¶å™¨
            });
            
            // å†å²è®°å½•æ¨¡æ€æ¡†äº‹ä»¶ç›‘å¬å™¨
            closeHistoryBtn.addEventListener('click', () => {
                historyModal.style.display = 'none';
            });
            
            clearHistoryBtn.addEventListener('click', clearHistory);
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            editPhasesModal.addEventListener('click', (e) => {
                if (e.target === editPhasesModal) {
                    editPhasesModal.style.display = 'none';
                }
            });
            
            ttsSettingsModal.addEventListener('click', (e) => {
                if (e.target === ttsSettingsModal) {
                    ttsSettingsModal.style.display = 'none';
                }
            });
            
            reportModal.addEventListener('click', (e) => {
                if (e.target === reportModal) {
                    reportModal.style.display = 'none';
                    resetTimer(); // å…³é—­æŠ¥å‘Šæ—¶é‡ç½®è®¡æ—¶å™¨
                }
            });
            
            historyModal.addEventListener('click', (e) => {
                if (e.target === historyModal) {
                    historyModal.style.display = 'none';
                }
            });
            
            // çª—å£å¤§å°æ”¹å˜æ—¶æ›´æ–°è½®ç›˜ä½ç½®å’ŒæŒ‰é’®æ˜¾ç¤º
            window.addEventListener('resize', () => {
                updateCarouselPosition();
                updateNavigationButtons();
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', initialize);
    </script>
</body>
</html>
